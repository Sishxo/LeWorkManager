                    <!-- Page Heading -->
                    <div class="d-sm-flex align-items-center justify-content-between mb-4" style="margin-bottom:0!important">
                        <h1 class="h3 mb-2 text-gray-800">任务详情</h1>
                        <a href="javascript:backToList()" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm">
                            <i class="fas fa-reply fa-sm text-white-50"></i> 返回列表
                        </a>
                    </div>
                    
                    <p class="mb-4">通过查看任务详情，了解任务详细情况，并决定是否报名参加</p>

                    <!-- 任务基础信息管理 DataTales -->
                    <div class="card shadow mb-4">
                        <!-- 卡片标题 -->
                        <div class="card-header py-3">
                            <div style="display:inline-block">
                                <h6 class="m-0 font-weight-bold text-primary">任务基础信息</h6>
                            </div>
                        </div>

                        <!-- 卡片内容 -->
                        <div class="card-body">
                            <div class="table-responsive">

                                <!-- 任务标题 -->
                                <div style="height:40px">
                                    <div style="display:inline-block;padding-top:8px">
                                        <font>任务标题：</font>
                                    </div>
                                    <div style="display:inline-block;width:40%">
                                        <font id="taskTitle"></font>
                                    </div>
                                </div>

                                <!-- 任务类型 -->
                                <div style="height:40px">
                                    <div style="display:inline-block;padding-top:8px">
                                        <font>任务类型：</font>
                                    </div>
                                    <div style="display:inline-block;width:10%">
                                        <font id="taskTypeSelect"></font>
                                    </div>
                                </div>

                                <!-- 任务标签 -->
                                <div style="height:40px">
                                    <div style="display:inline-block;padding-top:8px">
                                        <font>任务标签：</font>
                                    </div>
                                    <div style="display:inline-block;width:40%">
                                        <div id="taskLabels"></div>
                                    </div>
                                </div>

                                <!-- 泺研币 -->
                                <div style="margin-bottom:8px">
                                    <div style="display:inline-block;padding-top:8px">
                                        <font>泺研币：&nbsp;&nbsp;&nbsp;</font>
                                    </div>
                                    <div style="display:inline-block;width:40%;margin-top: 10px">
                                        <font id="taskMoney"></font>
                                    </div>
                                </div>

                                <!-- 泺学分 -->
                                <div style="margin-bottom:8px">
                                    <div style="display:inline-block;padding-top:8px">
                                        <font>泺学分：&nbsp;&nbsp;&nbsp;</font>
                                    </div>
                                    <div style="display:inline-block;width:40%;margin-top: 10px">
                                        <font id="taskPoint"></font>
                                    </div>
                                </div>

                                <!-- 计划开始时间 -->
                                <div style="height:40px">
                                    <div style="display:inline-block;padding-top:8px">
                                        <font>计划开始时间：</font>
                                    </div>
                                    <div style="display:inline-block;width:38%">
                                        <font id="beginDateTime"></font>
                                    </div>
                                </div>

                                <!-- 计划结束时间 -->
                                <div style="height:40px">
                                    <div style="display:inline-block;padding-top:8px">
                                        <font>计划结束时间：</font>
                                    </div>
                                    <div style="display:inline-block;width:38%">
                                        <font id="endDateTime"></font>
                                    </div>
                                </div>

                                <!-- 任务发布者 -->
                                <div style="height:40px">
                                    <div style="display:inline-block;padding-top:8px">
                                        <font>任务发布者：</font>
                                    </div>
                                    <div style="display:inline-block;width:40%">
                                        <font id="headPerson"></font>
                                    </div>
                                </div>

                                <!-- 任务附件 -->
                                <div style="height:40px">
                                    <div style="padding-top:8px">
                                        <font>任务附件：</font>
                                    </div>
                                    <div style="width:100%">
                                        <font id=""></font>
                                    </div>
                                </div>

                                <div id="uploadFileList" style="width:50%;margin-top:20px">
                                    <table class="table table-bordered" id="fileList" cellspacing="0">
                                        <thead>
                                            <tr>
                                                <th>序号</th>
                                                <th>文件名</th>
                                                <th>上传者</th>
                                                <th>下载</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>

                                <!-- 任务简介 -->
                                <div style="padding-top:8px;margin-bottom:8px">
                                    <font>任务简介(只读）：</font>
                                </div>
                                
                                <div class="document-editor" style="border:0;max-height:unset">
                                    <div id="toolbar-container" class="document-editor__toolbar" style="display:none"></div>
                                    <div class="document-editor__editable-container" style="overflow:auto;background:white">
                                        <div id="taskIntro" class="document-editor__editable">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 子任务 DataTales -->
                    <div class="card shadow mb-4">
                        <!-- 卡片标题 -->
                        <div class="card-header py-3">
                            <div style="display:inline-block;margin-top:8px">
                                <h6 class="m-0 font-weight-bold text-primary">子任务详情</h6>
                            </div>
                            <div id="addNewChildTasks" style="float:right;display:none">
                                <a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm" data-toggle="modal" data-target="#updateChildTask" onclick="getChildTaskId()">
                                    <i class="fas fa-plus fa-sm text-white-50"></i> 新增子任务
                                </a>
                            </div>
                        </div>
                        
                        <!-- 卡片内容 -->
                        <div class="card-body">
                            <div class="table-responsive">
                                <div id="dataTable_wrapper" class="dataTables_wrapper dt-bootstrap4">
                                    <table class="table table-bordered" id="childTasks" width="100%" cellspacing="0">
                                        <thead>
                                            <tr>
                                                <th>子任务序号</th>
                                                <th>子任务内容</th>
                                                <th>子任务完成进度</th>
                                                <th>执行人</th>
                                                <th>达到此进度时间</th>
                                                <th>计划完成时间</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 角色 DataTales -->
                    <div class="card shadow mb-4">

                        <!-- 卡片标题 -->
                        <div class="card-header py-3">
                            <div style="display:inline-block;margin-top:8px">
                                <h6 class="m-0 font-weight-bold text-primary">角色详情</h6>
                            </div>
                            <div style="float:right" id="scoreButton">
                                <a class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm" onclick="toScore()">
                                    <i class="fas fa-upload fa-sm text-white-50"></i> 成员互评
                                </a>
                            </div>
                        </div>
                        
                        <!-- 卡片内容 -->
                        <div class="card-body">
                            <div class="table-responsive">
                                <div id="dataTable_wrapper" class="dataTables_wrapper dt-bootstrap4">
                                    <table class="table table-bordered" id="roles" width="100%" cellspacing="0">
                                        <thead>
                                            <tr>
                                                <th>角色序号</th>
                                                <th>角色名称</th>
                                                <th>最多参与人数</th>
                                                <th>期望参与人数</th>
                                                <th>报名开始时间</th>
                                                <th>报名截止时间</th>
                                                <th></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 报名后显示 DataTales -->
                    <div class="card shadow mb-4" style="display:none">
                        <!-- 卡片标题 -->
                        <div class="card-header py-3">
                            <div style="display:inline-block;margin-top:8px">
                                <h6 class="m-0 font-weight-bold text-primary">报名管理</h6>
                            </div>
                            <div style="float:right">
                                <a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm" data-toggle="modal" data-target="#">
                                    <i class="fas fa-plus fa-sm text-white-50"></i> 指派任务
                                </a>
                            </div>
                        </div>
                        
                        <!-- 卡片内容 -->
                        <div class="card-body">
                            <div class="table-responsive">
                                <div id="dataTable_wrapper" class="dataTables_wrapper dt-bootstrap4">
                                    <table class="table table-bordered" id="" width="100%" cellspacing="0">
                                        <thead>
                                            <tr>
                                                <th>报名序号</th>
                                                <th>报名人</th>
                                                <th>报名角色</th>
                                                <th>报名时间</th>
                                                <th></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 报名详情 DataTales -->
                    <div class="card shadow mb-4">
                        <!-- 卡片标题 -->
                        <div class="card-header py-3">
                            <div style="display:inline-block;margin-top:8px">
                                <h6 class="m-0 font-weight-bold text-primary">报名/指派详情</h6>
                            </div>
                        </div>
                        
                        <!-- 卡片内容 -->
                        <div class="card-body">
                            <div class="table-responsive">
                                <div id="dataTable_wrapper" class="dataTables_wrapper dt-bootstrap4">
                                    <table class="table table-bordered" id="signUps" width="100%" cellspacing="0">
                                        <thead>
                                            <tr>
                                                <th>报名序号</th>
                                                <th>报名角色</th>
                                                <th>报名人</th>
                                                <th>报名/指派时间</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!------------------------- Modal 模态框 --------------------->

                    <!-- 报名信息确认 Modal-->
                    <div class="modal fade" id="signUpModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
                        aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel">任务领取确认</h5>
                                    <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">×</span>
                                    </button>
                                </div>
                                <div class="modal-body">

                                    <!-- 传参 -->
                                    <input type="hidden" id="roleId">

                                    <font>您确定要领取此任务吗？</font>
                                </div>
                                <div class="modal-footer">
                                    <button class="btn btn-secondary" type="button" data-dismiss="modal">取消</button>
                                    <a class="btn btn-primary" href="javascript:signUpTask()">确认领取</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 退出任务确认 Modal-->
                    <div class="modal fade" id="dropOutTask" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
                        aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel">任务退出确认</h5>
                                    <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">×</span>
                                    </button>
                                </div>
                                <div class="modal-body">

                                    <!-- 传参 -->
                                    <input type="hidden" id="signUpId">

                                    <font>您确定要退出此任务吗？</font>
                                </div>
                                <div class="modal-footer">
                                    <button class="btn btn-secondary" type="button" data-dismiss="modal">取消</button>
                                    <a class="btn btn-primary" href="javascript:dropOutTask()">确认退出</a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 子任务新增 修改 Modal-->
                    <div class="modal fade" id="updateChildTask" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
                        aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">

                                <!-- 传参 -->
                                <input type="hidden" id="childTaskId">

                                <div class="modal-header">
                                    <h5 id="changeChildTaskTitle" class="modal-title">子任务修改</h5>
                                    <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">×</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <!-- 标签 -->
                                    <div style="height:40px">
                                        <div style="float:left;padding-top:8px">
                                            <font>子任务内容：</font>
                                        </div>
                                        <div style="float:right;width:75%">
                                            <input id="childTaskChanged" class="form-control" placeholder="请输入子任务内容">
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button class="btn btn-secondary" type="button" data-dismiss="modal">取消</button>
                                    <a id="changeChildTaskButton" class="btn btn-primary" href="javascript:updateChildTask()">确认修改</a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- JS脚本 -->
                    <script type="text/javascript">
                        // console.log(localStorage.getItem("taskId"))
                        // var taskType
                        // var taskInfo
                        // var taskLabels
                        // var childTasks
                        // var roles

                        // 复杂输入框
                        DecoupledEditor
                            .create( document.querySelector( '#taskIntro' ), {
                                //工具栏，可选择添加或去除
                                toolbar: [],
                                //editor加载中文简体，默认是英文
                                language: 'zh-cn',
                                ckfinder: {
                                    uploadUrl: '/ckfinder/core/connector/php/connector.php?command=QuickUpload&type=Images&responseType=json'
                                }
                            } )
                            .then( taskIntro => {
                                const toolbarContainer = document.querySelector( '#toolbar-container' );

                                toolbarContainer.appendChild( taskIntro.ui.view.toolbar.element );

                                taskIntro.isReadOnly = true

                                window.taskIntro = taskIntro
                            } )
                            .catch( error => {
                                console.error( error );
                            } );

                        // 获取任务类型
                        $.ajax({
                            contentType: "application/x-www-form-urlencoded",
                            url:"../api/getTaskType.php",
                            type: "POST",
                            data:{},
                            success:function(res){
                                // console.log(res)
                                var res_json = JSON.parse(res)
                                // console.log(res_json)
                                // console.log(res_json.code)
                                if (res_json.code == 200)
                                {
                                    // 获取成功
                                    // console.log(res_json.message)
                                    taskType = res_json.message

                                    // 回调
                                    getTaskInfoById()
                                    getSignUpsById()
                                    getTaskLabelsById()
                                    getChildTasksById()
                                    getFileListByTaskId()
                                }
                                else
                                {
                                    // 获取失败，显示原因
                                    console.log("获取任务类型失败")
                                }
                            }
                        })

                        // 获取发起者姓名
                        function getHeadPersonNameById(headPersonId)
                        {
                            // ajax
                            $.ajax({
                                contentType: "application/x-www-form-urlencoded",
                                url:"../api/getHeadPersonNameById.php",
                                type: "POST",
                                data:{
                                    headPersonId: headPersonId
                                },
                                success:function(res){
                                    // console.log(res)
                                    var res_json = JSON.parse(res)
                                    // console.log(res_json)
                                    // console.log(res_json.code)
                                    if (res_json.code == 200)
                                    {
                                        // 获取成功
                                        // console.log(res_json.message[0])
                                        headPersonInfo = res_json.message[0]
                                        document.getElementById('headPerson').innerHTML = headPersonInfo.name
                                    }
                                    else
                                    {
                                        // 获取失败，显示原因
                                        console.log("获取发起者姓名失败")
                                    }
                                }
                            })
                        }
                        
                        // 获取任务基础信息
                        function getTaskInfoById()
                        {
                            // ajax
                            $.ajax({
                                contentType: "application/x-www-form-urlencoded",
                                url:"../api/getTaskInfoById.php",
                                type: "POST",
                                data:{
                                    taskId: localStorage.getItem("taskId")
                                },
                                success:function(res){
                                    // console.log(res)
                                    var res_json = JSON.parse(res)
                                    // console.log(res_json)
                                    // console.log(res_json.code)
                                    if (res_json.code == 200)
                                    {
                                        // 获取成功
                                        // console.log(res_json.message)
                                        taskInfo = res_json.message

                                        getHeadPersonNameById(taskInfo.headPerson)

                                        // 显示到文本框
                                        document.getElementById('taskTitle').innerHTML = taskInfo.proName
                                        document.getElementById('taskMoney').innerHTML = taskInfo.taskMoney
                                        document.getElementById('taskPoint').innerHTML = taskInfo.taskPoint
                                        // document.getElementById('taskIntro').innerHTML = taskInfo.introduction
                                        taskIntro.setData(taskInfo.introduction)
                                        document.getElementById('beginDateTime').innerHTML = taskInfo.startTime
                                        document.getElementById('endDateTime').innerHTML = taskInfo.endTime

                                        // 显示类型到下拉菜单
                                        // console.log(res_json.message)
                                        $.each(taskType, function(i, taskType) {
                                            // console.log(taskType)
                                            // 设置默认
                                            if (taskType.id == taskInfo.projectType)
                                            {
                                                document.getElementById('taskTypeSelect').innerHTML = taskType.projectType
                                            }
                                        })
                                    }
                                    else
                                    {
                                        // 获取失败，显示原因
                                        console.log("获取任务类型失败")
                                    }
                                }
                            })
                        }

                        /* ------------- 报名信息获取 -------------*/

                        // 获取报名信息
                        function getSignUpsById()
                        {
                            // ajax
                            $.ajax({
                                contentType: "application/x-www-form-urlencoded",
                                url:"../api/getSignUpsById.php",
                                type: "POST",
                                data:{
                                    taskId: localStorage.getItem("taskId"),
                                    // userId: userInfoJson.id
                                },
                                success:function(res){
                                    // console.log(res)
                                    var res_json = JSON.parse(res)
                                    // console.log(res_json)
                                    // console.log(res_json.code)
                                    if (res_json.code == 200)
                                    {
                                        // 获取成功
                                        // console.log(res_json.message)

                                        // 保存
                                        $.each(res_json.message, function(i, signUpMes) {
                                            if (signUpMes.userId == userInfoJson.id)
                                            {
                                                signUpMessage = signUpMes
                                            }
                                        })
                                        // console.log(signUpMessage)

                                        // 填充表格
                                        $.each(res_json.message, function(i, signUp) {
                                            
                                            // index
                                            var index = Number(i) + 1

                                            // 如果已经报过名了，就可以新增子任务
                                            // console.log(signUp.userId)
                                            // console.log(userInfoJson.id)
                                            if (signUp.userId == userInfoJson.id)
                                            {
                                                document.getElementById("addNewChildTasks").style.display="block"
                                            }

                                            let str="<tr>"            
                                                + "<td>" + index + "</td>"
                                                + "<td> " + signUp.roleName + "</td>"
                                                + "<td> " + signUp.userRealName + "</td>"
                                                + "<td> " + signUp.signUpTime + "</td>"
                                                + "</tr>";

                                            $("#signUps").append(str);
                                        })

                                        // 回调
                                        getRolesById()
                                    }
                                    else
                                    {
                                        // 获取失败，显示原因
                                        console.log("获取报名信息失败")
                                        let str="<tr><td colspan=\"4\" align=\"center\"> 暂无报名信息 </td></tr>"
                                        $("#signUps").append(str);

                                        // 回调
                                        getRolesById()
                                    }
                                }
                            })
                        }

                        /* ------------- 报名信息获取 -------------*/

                        /* ------------- 任务标签 -------------*/

                        // 获取任务标签
                        function getTaskLabelsById()
                        {
                            // ajax
                            $.ajax({
                                contentType: "application/x-www-form-urlencoded",
                                url:"../api/getTaskLabelsById.php",
                                type: "POST",
                                data:{
                                    taskId: localStorage.getItem("taskId")
                                },
                                success:function(res){
                                    // console.log(res)
                                    var res_json = JSON.parse(res)
                                    // console.log(res_json)
                                    // console.log(res_json.code)
                                    if (res_json.code == 200)
                                    {
                                        // 获取成功
                                        // console.log(res_json.message)
                                        
                                        // 显示标签
                                        var taskLabelText = ""
                                        $.each(res_json.message, function(i, taskLabel) {
                                            // console.log(taskLabel.label)
                                            taskLabelText = taskLabelText + "<span class=\"label label-info\">" + taskLabel.label + "</span>&nbsp;"
                                            // console.log(taskLabelText)
                                        })
                                        document.getElementById('taskLabels').innerHTML = taskLabelText
                                    }
                                    else
                                    {
                                        // 获取失败，显示原因
                                        console.log("获取标签失败")
                                    }
                                }
                            })
                        }

                        /* ------------- 任务标签 -------------*/

                        /* ------------- 子任务 -------------*/

                        // 获取子任务
                        function getChildTasksById()
                        {
                            // ajax
                            $.ajax({
                                contentType: "application/x-www-form-urlencoded",
                                url:"../api/getChildTasksById.php",
                                type: "POST",
                                data:{
                                    taskId: localStorage.getItem("taskId")
                                },
                                success:function(res){
                                    // console.log(res)
                                    var res_json = JSON.parse(res)
                                    // console.log(res_json)
                                    // console.log(res_json.code)
                                    if (res_json.code == 200)
                                    {
                                        // 获取成功
                                        // console.log(res_json.message)
                                        childTasks = res_json.message
                                        
                                        // 填充表格
                                        $.each(res_json.message, function(i, childTask) {
                                            
                                            // index
                                            var index = Number(i) + 1

                                            let str="<tr>"            
                                                + "<td>" + index + "</td>"
                                                + "<td> " + childTask.name + " </td>"
                                                + "<td> "
                                                + "<div class=\"progress\"> \
                                                    <div class=\"progress-bar\" role=\"progressbar\" style=\"width:" + childTask.maxPercent + "%;\" aria-valuenow=\"" + childTask.maxPercent + "\" aria-valuemin=\"0\" aria-valuemax=\"100\">" + childTask.maxPercent + "%</div> \
                                                   </div> </td>"
                                                + "<td> " + childTask.maxUser + " </td>"
                                                + "<td> " + childTask.maxPercentTime + " </td>"
                                                + "<td> " + childTask.maxPlanPercentTime + " </td>"
                                                + "</tr>";

                                            $("#childTasks").append(str);
                                        })
                                    }
                                    else
                                    {
                                        // 获取失败，显示原因
                                        console.log("获取子任务失败")
                                        let str="<tr><td colspan=\"6\" align=\"center\"> 暂无子任务 </td></tr>"
                                        $("#childTasks").append(str);
                                    }
                                }
                            })
                        }

                        // 子任务模态框获取数据
                        function getChildTaskId()
                        {
                            if (arguments.length > 0)
                            {
                                // console.log(arguments)
                                $("#childTaskId").val(childTasks[arguments[0]].id)
                                $("#childTaskChanged").val(childTasks[arguments[0]].name)
                                document.getElementById('changeChildTaskTitle').innerHTML = "子任务修改"
                                document.getElementById('changeChildTaskButton').innerHTML = "确认修改"
                            }
                            else
                            {
                                $("#childTaskId").val("")
                                $("#childTaskChanged").val("")
                                document.getElementById('changeChildTaskTitle').innerHTML = "子任务新增"
                                document.getElementById('changeChildTaskButton').innerHTML = "确认新增"
                            }
                        }

                        // 新增 修改子任务
                        function updateChildTask()
                        {
                            // 权限判断该任务是否需要审核
                            var adminCheck = 0
                            if (userInfoJson.permit < 2)
                            {
                                adminCheck = 1
                            }
                            
                            // 判空
                            if (document.getElementById('childTaskChanged').value == "")
                            {
                                toastr.error('子任务内容不能为空')
                            }
                            else if (document.getElementById('childTaskId').value == "")
                            {
                                // 增加
                                console.log("新增子任务")
                                // ajax
                                $.ajax({
                                    contentType: "application/x-www-form-urlencoded",
                                    url:"../api/createNewChildTask.php",
                                    type: "POST",
                                    data:{
                                        childTaskName: document.getElementById('childTaskChanged').value,
                                        taskId: taskInfo.id,
                                        adminCheck: adminCheck
                                    },
                                    success:function(res){
                                        // console.log(res)
                                        var res_json = JSON.parse(res)
                                        // console.log(res_json)
                                        // console.log(res_json.code)
                                        
                                        if (res_json.code == 200)
                                        {
                                            // 发布成功
                                            toastr.success('子任务新增成功')

                                            // 延时
                                            setTimeout( function(){
                                                // 跳转
                                                // toPublishTasks()
                                                location.reload()
                                            }, 2 * 1000 );//延迟2000毫秒
                                        }
                                        else
                                        {
                                            // 发布失败，显示原因
                                            console.log("子任务新增失败")
                                            toastr.error(res_json.message)
                                        }
                                    }
                                })
                            }
                            else
                            {
                                // 修改
                                console.log("修改子任务")
                                // ajax
                                $.ajax({
                                    contentType: "application/x-www-form-urlencoded",
                                    url:"../api/updateChildTask.php",
                                    type: "POST",
                                    data:{
                                        childTaskId: document.getElementById('childTaskId').value,
                                        childTaskName: document.getElementById('childTaskChanged').value,
                                        taskId: taskInfo.id,
                                        adminCheck: adminCheck
                                    },
                                    success:function(res){
                                        // console.log(res)
                                        var res_json = JSON.parse(res)
                                        // console.log(res_json)
                                        // console.log(res_json.code)
                                        
                                        if (res_json.code == 200)
                                        {
                                            // 发布成功
                                            toastr.success('子任务修改成功')

                                            // 延时
                                            setTimeout( function(){
                                                // 跳转
                                                // toPublishTasks()
                                                location.reload()
                                            }, 2 * 1000 );//延迟2000毫秒
                                        }
                                        else
                                        {
                                            // 发布失败，显示原因
                                            // console.log("子任务修改失败")
                                            toastr.error(res_json.message)
                                        }
                                    }
                                })
                            }
                        }

                        /* ------------- 子任务 -------------*/

                        /* ------------- 角色 -------------*/

                        // 获取角色信息
                        function getRolesById()
                        {
                            // ajax
                            $.ajax({
                                contentType: "application/x-www-form-urlencoded",
                                url:"../api/getRolesById.php",
                                type: "POST",
                                data:{
                                    taskId: localStorage.getItem("taskId")
                                },
                                success:function(res){
                                    // console.log(res)
                                    var res_json = JSON.parse(res)
                                    // console.log(res_json)
                                    // console.log(res_json.code)
                                    if (res_json.code == 200)
                                    {
                                        // 获取成功
                                        // console.log(res_json.message)
                                        roles = res_json.message
                                        var currentTime = getCurrentTime()
                                        
                                        // 填充表格
                                        $.each(res_json.message, function(i, role) {
                                            
                                            // index
                                            var index = Number(i) + 1

                                            // ButtonText 按钮文字
                                            if (typeof signUpMessage != "undefined") 
                                            {
                                                // 如果报名了，就显示退出
                                                document.getElementById('scoreButton').style = "float:right"
                                                if (role.id == signUpMessage.roleId)
                                                {
                                                    // console.log(currentTime)
                                                    // console.log(taskInfo.endTime)
                                                    // 这一行
                                                    var buttonText = "<td> \
                                                                <a class=\"d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm\" onclick=\"toProgress(" + i + ")\"> \
                                                                    <i class=\"fas fa-upload fa-sm text-white-50\"></i> 上报进度 \
                                                                </a> \
																<a class=\"d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm\" onclick=\"submitPro(" + i + ")\"> \
                                                                    <i class=\"fas fa-upload fa-sm text-white-50\"></i> 任务提交 \
                                                                </a> \
                                                                <a class=\"d-none d-sm-inline-block btn btn-sm btn-secondary shadow-sm\" data-toggle=\"modal\" data-target=\"#dropOutTask\" onclick=\"getsignUpId(" + signUpMessage.id + ", " + signUpMessage.roleId + ")\"> \
                                                                    <i class=\"fas fa-minus-circle fa-sm text-white-50\"></i> 退出任务 \
                                                                </a> \
                                                            </td>"
                                                }
                                                else
                                                {
                                                    // 不是这一行
                                                    // 按照时间分
                                                    if (role.signUpEndTime > currentTime)
                                                    {
                                                        var buttonText = "<td> \
                                                                        <a class=\"d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm\" data-toggle=\"modal\" data-target=\"#signUpModal\" onclick=\"getRoleId(" + i + ")\"> \
                                                                            <i class=\"fas fa-plus-circle fa-sm text-white-50\"></i> 主动领取 \
                                                                        </a> \
                                                                    </td>"
                                                    }
                                                    else
                                                    {
                                                        var buttonText = "<td> \
                                                                        <button class=\"d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm\" disabled> \
                                                                            <i class=\"fas fa-plus-circle fa-sm text-white-50\"></i> 已经截止 \
                                                                        </button> \
                                                                    </td>"
                                                    }
                                                }
                                                
                                            }
                                            else
                                            {
                                                // 否则，就按照时间显示
                                                document.getElementById('scoreButton').style = "display:none"
                                                // 按照时间分
                                                if (role.signUpEndTime > currentTime)
                                                {
                                                    var buttonText = "<td> \
                                                                    <a class=\"d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm\" data-toggle=\"modal\" data-target=\"#signUpModal\" onclick=\"getRoleId(" + i + ")\"> \
                                                                        <i class=\"fas fa-plus-circle fa-sm text-white-50\"></i> 主动领取 \
                                                                    </a> \
                                                                </td>"
                                                }
                                                else
                                                {
                                                    var buttonText = "<td> \
                                                                    <button class=\"d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm\" disabled> \
                                                                        <i class=\"fas fa-plus-circle fa-sm text-white-50\"></i> 已经截止 \
                                                                    </button> \
                                                                </td>"
                                                }
                                            }

                                            let str="<tr>"            
                                                + "<td>" + index + "</td>"
                                                + "<td> " + role.roleName + " </td>"
                                                + "<td> " + role.wantPersonNum + " </td>"
                                                + "<td> " + role.leastPersonNum + " </td>"
                                                + "<td> " + role.signUpBeginTime + " </td>"
                                                + "<td> " + role.signUpEndTime + " </td>"                        
                                                + buttonText
                                                + "</tr>";

                                            $("#roles").append(str);
                                        })
                                    }
                                    else
                                    {
                                        // 获取失败，显示原因
                                        console.log("获取角色失败")
                                        document.getElementById('scoreButton').style = "display:none"
                                        let str="<tr><td colspan=\"7\" align=\"center\"> 暂无角色 </td></tr>"
                                        $("#roles").append(str);
                                    }
                                }
                            })
                        }

                        // 角色模态框获取数据
                        function getRoleId()
                        {
                            // console.log(arguments)
                            $("#roleId").val(roles[arguments[0]].id)
                        }

                        /* ------------- 角色 -------------*/

                        // 退出任务模态框
                        function getsignUpId()
                        {
                            $("#signUpId").val(arguments[0])
                            $("#roleId").val(arguments[1])
                        }

                        // 退出任务
                        function dropOutTask()
                        {
                            // console.log(document.getElementById('signUpId').value)
                            // ajax
                            $.ajax({
                                contentType: "application/x-www-form-urlencoded",
                                url:"../api/dropSignUp.php",
                                type: "POST",
                                data:{
                                    signUpId: document.getElementById('signUpId').value,
                                    roleId: document.getElementById('roleId').value
                                },
                                success:function(res){
                                    // console.log(res)
                                    var res_json = JSON.parse(res)
                                    // console.log(res_json)
                                    // console.log(res_json.code)
                                    if (res_json.code == 200)
                                    {
                                        // 删除成功
                                        toastr.success('退出任务成功')

                                        // 延时
                                        setTimeout( function(){
                                            // 跳转
                                            // toPublishTasks()
                                            location.reload()
                                        }, 2 * 1000 );//延迟2000毫秒
                                    }
                                    else
                                    {
                                        // 发布失败，显示原因
                                        // console.log("退出任务失败")
                                        toastr.error('退出任务失败')
                                    }
                                }
                            })
                        }

                        // 任务领取
                        function signUpTask()
                        {
                            // 自己不能领取自己创建的任务？
                            // ajax
                            // 修改任务基础信息
                            $.ajax({
                                contentType: "application/x-www-form-urlencoded",
                                url:"../api/signUpTask.php",
                                type: "POST",
                                data:{
                                    taskId: localStorage.getItem("taskId"),
                                    userId: userInfoJson.id,
                                    roleId: document.getElementById('roleId').value,
                                    nowTime: getCurrentTime()
                                },
                                success:function(res){
                                    // console.log(res)
                                    var res_json = JSON.parse(res)
                                    // console.log(res_json)
                                    // console.log(res_json.code)
                                    if (res_json.code == 200)
                                    {
                                        // 任务领取成功
                                        toastr.success('任务领取成功')

                                        // 延时
                                        setTimeout( function(){
                                            // 刷新
                                            // toPublishTasks()
                                            location.reload()
                                        }, 2 * 1000 );//延迟2000毫秒
                                    }
                                    else
                                    {
                                        // 显示原因
                                        // console.log("任务领取失败")
                                        toastr.error(res_json.message)
                                    }
                                }
                            })

                            // localStorage.setItem("nowPage", "createNewTask");
                            // location.reload();
                            // console.log("1")
                        }

                        // 获取客户端当前时间
                        function getCurrentTime()
                        {
                            var date = new Date();
			
                            var year = date.getFullYear();        //年 ,从 Date 对象以四位数字返回年份
                            var month = date.getMonth() + 1;      //月 ,从 Date 对象返回月份 (0 ~ 11) ,date.getMonth()比实际月份少 1 个月
                            var day = date.getDate();             //日 ,从 Date 对象返回一个月中的某一天 (1 ~ 31)
                            
                            var hours = date.getHours();          //小时 ,返回 Date 对象的小时 (0 ~ 23)
                            var minutes = date.getMinutes();      //分钟 ,返回 Date 对象的分钟 (0 ~ 59)
                            var seconds = date.getSeconds();      //秒 ,返回 Date 对象的秒数 (0 ~ 59)   
                            
                            //修改月份格式
                            if (month >= 1 && month <= 9) {
                                month = "0" + month;
                                }
                            
                            //修改日期格式
                            if (day >= 0 && day <= 9) {
                                day = "0" + day;
                                }
                            
                            //修改小时格式
                            if (hours >= 0 && hours <= 9) {
                                hours = "0" + hours;
                                }
                            
                            //修改分钟格式
                            if (minutes >= 0 && minutes <= 9) {
                                minutes = "0" + minutes;
                                }
                            
                            //修改秒格式
                            if (seconds >= 0 && seconds <= 9) {
                                seconds = "0" + seconds;
                                }
                            
                            //获取当前系统时间  格式(yyyy-mm-dd hh:mm:ss)
                            var currentFormatDate = year + "-" + month + "-" + day + " " + hours + ":" + minutes + ":" + seconds;
                            return currentFormatDate
                        }

                        // 去进度页面
                        function toProgress(i)
                        {
                            localStorage.setItem("roleId", roles[i].id);
                            // localStorage.setItem("nowPage", "schedule");
                            // location.reload();
                            window.location.href = "index.php?nowPage=schedule";
                        }
						
						// 提交任务
						function submiPro()
						{
						
						
						}

                        // 返回列表
                        function backToList()
                        {
                            if (localStorage.getItem("fromPage") == "index")
                            {
                                localStorage.removeItem("fromPage")
                                toIndexWithLocalStorage()
                            }
                            else if (localStorage.getItem("fromPage") == "joinedTasks")
                            {
                                localStorage.removeItem("fromPage")
                                toJoinedTasksWithLocalStorage()
                            }
                            else if (localStorage.getItem("fromPage") == "pointsStatistics")
                            {
                                localStorage.removeItem("fromPage")
                                toPointsStatisticsWithLocalStorage()
                            }
                        }
						
                        // 去打分页面
                        function toScore()
                        {
                            // localStorage.setItem("nowPage", "score");
                            // location.reload();
                            window.location.href = "index.php?nowPage=score";
                        }

                        function getFileListByTaskId()
                        {
                            // ajax
                            $.ajax({
                                contentType: "application/x-www-form-urlencoded",
                                url:"../api/getFileListByTaskId.php",
                                type: "POST",
                                data:{
                                    taskId: localStorage.getItem("taskId")
                                },
                                success:function(res){
                                    // console.log(res)
                                    var res_json = JSON.parse(res)
                                    // console.log(res_json)
                                    // console.log(res_json.code)
                                    if (res_json.code == 200)
                                    {
                                        // 获取成功
                                        // console.log(res_json.message)
                                        // files = res_json.message
                                        
                                        
                                        // 填充表格
                                        $.each(res_json.message, function(i, file) {
                                            
                                            // index
                                            var index = Number(i) + 1

                                            let str="<tr>"            
                                                + "<td>" + index + "</td>"
                                                + "<td> " + file.fileName + " </td>"
                                                + "<td> " + file.userName + " </td>"
                                                + "<td><a type=\"button\" class=\"btn btn-primary\" value=\"下载\" href=\"./uploads/"+file.taskId+"/"+file.userId+"/"+file.fileName+"\" download>下载</td>"                      
                                                + "</tr>";

                                            $("#fileList").append(str);
                                        })

                                    }
                                    else
                                    {
                                        // 获取失败，显示原因
                                        console.log("获取文件列表失败")

                                    }
                                }
                            })
                        }

                        function downloadFile(filePath)
                        {
                            filePath="../uploads/"+filePath;
                            window.open(filePath)
                        }
                    </script>