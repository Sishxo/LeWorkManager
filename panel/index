                    <!-- Page Heading -->
                    <h1 class="h3 mb-2 text-gray-800">任务大厅</h1>
                    <p class="mb-4">请在任务大厅中挑选自己中意的任务报名吧</p>

                    <!-- DataTales Example -->
                    <div class="card shadow mb-4">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary">可报名任务</h6>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <div id="dataTable_wrapper" class="dataTables_wrapper dt-bootstrap4">

                                    <!-- 表格上方 -->
                                    <div class="row" style="margin-bottom:0.5rem">
                                        
                                        <!-- 每页显示几条 -->
                                        <div class="col-sm-12 col-md-6">
                                            <div class="dataTables_length" id="dataTable_length">
                                                <label>
                                                    <div style="display:inline-block; margin-right:5px">
                                                        <font>每页显示</font>
                                                    </div>

                                                    <div style="display:inline-block">
                                                        <select id="unfinishedAllTasks_length" aria-controls="dataTable" class="custom-select custom-select-sm form-control form-control-sm" onchange="unfinishedAllTasks_lengthChange()">
                                                            <option value="10">10</option>
                                                            <option value="25">25</option>
                                                            <option value="50">50</option>
                                                            <option value="100">100</option>
                                                        </select>
                                                    </div>

                                                    <div style="display:inline-block; margin-left: 5px">
                                                        <font>条</font>
                                                    </div>
                                                </label>
                                            </div>
                                        </div>

                                        <!-- 搜索框 -->
                                        <div class="col-sm-12 col-md-6">
                                            <div id="dataTable_filter" class="dataTables_filter">
                                                <label>
                                                    <div style="display:inline-block">
                                                        <font>筛选查找：</font>
                                                    </div>

                                                    <div style="display:inline-block">
                                                        <input type="search" class="form-control form-control-sm" aria-controls="dataTable">
                                                        </input>
                                                    </div>

                    
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 表格本体 -->
                                    <div class="row">
                                        <div class="col-sm-12">    
                                            <table class="table table-bordered" id="unfinishedAllTasksTable" width="100%" cellspacing="0" onclick="unfinishedAllTasksClick()">
                                                <thead>
                                                    <tr>
                                                        <th>任务序号</th>
                                                        <th>任务分类</th>
                                                        <th>任务标题</th>
                                                        <th>任务标签</th>
                                                        <th>报名截止时间</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <!-- 表格下方 -->
                                    <div class=row>
                                        
                                        <!-- 显示编号 -->
                                        <div class="col-sm-12 col-md-5">
                                            
                                        </div>

                                        <!-- 上一页 下一页 -->
                                        <div class="col-sm-12 col-md-7">
                                            <div class="dataTables_paginate paging_simple_numbers" id="dataTable_paginate">
                                                <ul class="pagination">
                                                    <li class="paginate_button page-item" id="dataTable_previous">
                                                        <a href="" aria-controls="dataTable" data-dt-idx="0" tabindex="0" class="page-link">
                                                            上一页
                                                        </a>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- DataTales Example -->
                    <div class="card shadow mb-4">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary">已截止历史任务</h6>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <div id="dataTable_wrapper" class="dataTables_wrapper dt-bootstrap4">

                                    <!-- 表格上方 -->
                                    <div class="row" style="margin-bottom:0.5rem">
                                        
                                        <!-- 每页显示几条 -->
                                        <div class="col-sm-12 col-md-6">
                                            <div class="dataTables_length" id="dataTable_length">
                                                <label>
                                                    <div style="display:inline-block; margin-right:5px">
                                                        <font>每页显示</font>
                                                    </div>

                                                    <div style="display:inline-block">
                                                        <select id="finishedAllTasks_length" aria-controls="dataTable" class="custom-select custom-select-sm form-control form-control-sm" onchange="finishedAllTasks_lengthChange()">
                                                            <option value="10">10</option>
                                                            <option value="25">25</option>
                                                            <option value="50">50</option>
                                                            <option value="100">100</option>
                                                        </select>
                                                    </div>

                                                    <div style="display:inline-block; margin-left: 5px">
                                                        <font>条</font>
                                                    </div>
                                                </label>
                                            </div>
                                        </div>

                                        <!-- 搜索框 -->
                                        <div class="col-sm-12 col-md-6">
                                            <div id="dataTable_filter" class="dataTables_filter">
                                                <label>
                                                    <div style="display:inline-block">
                                                        <font>筛选查找：</font>
                                                    </div>

                                                    <div style="display:inline-block">
                                                        <input type="search" class="form-control form-control-sm" aria-controls="dataTable">
                                                        </input>
                                                    </div>

                    
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 表格本体 -->
                                    <div class="row">
                                        <div class="col-sm-12">    
                                            <table class="table table-bordered" id="finishedAllTasksTable" width="100%" cellspacing="0" onclick="finishedAllTasksClick()">
                                                <thead>
                                                    <tr>
                                                        <th>任务序号</th>
                                                        <th>任务分类</th>
                                                        <th>任务标题</th>
                                                        <th>任务标签</th>
                                                        <th>报名截止时间</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <!-- 表格下方 -->
                                    <div class=row>
                                        
                                        <!-- 显示编号 -->
                                        <div class="col-sm-12 col-md-5">
                                        </div>

                                        <!-- 上一页 下一页 -->
                                        <div class="col-sm-12 col-md-7">
                                            <div class="dataTables_paginate paging_simple_numbers" id="dataTable_paginate">

                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>


                    <script type="text/javascript">
                        // 初始化页码
                        var unfinishedPage = 1  // 报名未截止任务页码
                        var finishedPage = 1    // 报名截止任务页码
                        var taskType
                        // var unfinishedAllTasksList
                        // var finishedAllTasksList

                        $('[data-toggle="tooltip"]').tooltip()

                        // 获取任务类型
                        $.ajax({
                            contentType: "application/x-www-form-urlencoded",
                            url:"../api/getTaskType.php",
                            type: "POST",
                            data:{},
                            success:function(res){
                                // console.log(res)
                                var res_json = JSON.parse(res)
                                // console.log(res_json)
                                // console.log(res_json.code)
                                if (res_json.code == 200)
                                {
                                    // 获取成功
                                    // console.log(res_json.message)

                                    // 储存
                                    taskType = res_json.message

                                    // 回调
                                    getUnfinishedPublicTasks()
                                    getFinishedPublicTasks()
                                }
                                else
                                {
                                    // 获取失败，显示原因
                                    console.log("获取任务类型失败")
                                }
                            }
                        })


                        // 获取未截止数据
                        function getUnfinishedPublicTasks()
                        {
                            // console.log($('#unfinishedAllTasks_length option:selected').val())

                            $.ajax({
                                contentType: "application/x-www-form-urlencoded",
                                url:"../api/unfinishedAllTasks.php",
                                type: "POST",
                                data:{
                                    page: unfinishedPage,
                                    length: $('#unfinishedAllTasks_length option:selected').val()
                                },
                                success:function(res){
                                    // console.log(res)
                                    var res_json = JSON.parse(res)
                                    // console.log(res_json)
                                    // console.log(res_json.code)
                                    if (res_json.code == 200)
                                    {
                                        // 获取成功
                                        console.log(res_json.message)
                                        // console.log(taskType['0'].projectType)
                                        unfinishedAllTasksList = res_json.message

                                        // 显示到下拉菜单
                                        $.each(res_json.message, function(i, task) {
                                            // 显示标签
                                            var taskLabelText = ""
                                            $.each(task.labels, function(i, taskLabel) {
                                                // console.log(taskLabel.label)
                                                taskLabelText = taskLabelText + "<span class=\"label label-info\">" + taskLabel.label + "</span>&nbsp;"
                                                // console.log(taskLabelText)
                                            })

                                            // console.log(task)
                                            var index = (unfinishedPage - 1) * $('#unfinishedAllTasks_length option:selected').val() + Number(i) + 1
                                            // console.log(index)
                                            
                                            // console.log(task.projectType)
                                            // console.log(taskType['0'])
                                            // console.log(taskType[task.projectType - 1])
                                            // console.log(taskType[task.projectType - 1].projectType)

                                            // 显示提示框
                                            // taskNameText = "<span data-toggle=\"tooltip\" data-placement=\"right\" title=\"" + task.introduction + "\">" + task.proName + "</span>"
                                            taskNameText = task.proName

                                            // 查找任务类型
                                            var pos = 0;
                                            var hasProType = false;
                                            while (pos < getJsonLength(taskType))
                                            {
                                                // console.log(task.projectType)
                                                // console.log(taskType[pos].id)
                                                if (task.projectType == taskType[pos].id)
                                                {
                                                    hasProType = true;
                                                    break;
                                                }
                                                pos = pos + 1;
                                            }
                                            // console.log(hasProType);
                                            if (hasProType)
                                            {
                                                var proTypeText = "<td>" + taskType[pos].projectType + "</td>";
                                            }
                                            else
                                            {
                                                var proTypeText = "<td> 未分类 </td>"
                                            }

                                            // console.log(taskNameText)

                                            let str="<tr>"            
                                                + "<td>" + index + "</td>"
                                                + proTypeText
                                                + "<td>" + taskNameText + "</td>"                        
                                                + "<td>" + taskLabelText + "</td>"
                                                + "<td>" + task.signUpEndTime + "</td>"
                                                + "</tr>";

                                            $("#unfinishedAllTasksTable").append(str);

                                            // console.log(str)
                                        })
                                    }
                                    else
                                    {
                                        // 获取失败，显示原因
                                        console.log("拉取任务列表失败")
                                        let str="<tr><td colspan=\"5\" align=\"center\"> 暂无可报名任务 </td></tr>"
                                        $("#unfinishedAllTasksTable").append(str);
                                    }
                                }
                            })
                        }

                        // 未截止数据页码改变
                        function unfinishedAllTasks_lengthChange()
                        {
                            document.getElementById('unfinishedAllTasksTable').innerHTML = "<thead> \
                                                    <tr> \
                                                        <th>任务序号</th> \
                                                        <th>任务分类</th> \
                                                        <th>任务标题</th> \
                                                        <th>任务标签</th> \
                                                        <th>报名截止时间</th> \
                                                    </tr> \
                                                </thead> \
                                                <tbody> \
                                                </tbody>"
                            getUnfinishedPublicTasks()
                        }

                        // 获取已截止数据
                        function getFinishedPublicTasks()
                        {
                            // console.log($('#unfinishedAllTasks_length option:selected').val())

                            $.ajax({
                                contentType: "application/x-www-form-urlencoded",
                                url:"../api/finishedAllTasks.php",
                                type: "POST",
                                data:{
                                    page: finishedPage,
                                    length: $('#finishedAllTasks_length option:selected').val()
                                },
                                success:function(res){
                                    // console.log(res)
                                    var res_json = JSON.parse(res)
                                    // console.log(res_json)
                                    // console.log(res_json.code)
                                    if (res_json.code == 200)
                                    {
                                        // 获取成功
                                        // console.log(res_json.message)
                                        // console.log(taskType['0'].projectType)
                                        finishedAllTasksList = res_json.message

                                        // 显示到下拉菜单
                                        $.each(res_json.message, function(i, task) {
                                            // 显示标签
                                            var taskLabelText = ""
                                            $.each(task.labels, function(i, taskLabel) {
                                                // console.log(taskLabel.label)
                                                taskLabelText = taskLabelText + "<span class=\"label label-info\">" + taskLabel.label + "</span>&nbsp;"
                                                // console.log(taskLabelText)
                                            })

                                            // console.log(task)
                                            var index = (finishedPage - 1) * $('#finishedAllTasks_length option:selected').val() + Number(i) + 1
                                            // console.log(index)
                                            
                                            // console.log(task.projectType)
                                            // console.log(taskType['0'])
                                            // console.log(taskType[task.projectType - 1])
                                            // console.log(taskType[task.projectType - 1].projectType)

                                            // 显示提示框
                                            // taskNameText = "<span data-toggle=\"tooltip\" data-placement=\"right\" title=\"" + task.introduction + "\">" + task.proName + "</span>"
                                            taskNameText = task.proName
                                            // console.log(taskNameText)

                                            // 查找任务类型
                                            var pos = 0;
                                            var hasProType = false;
                                            while (pos < getJsonLength(taskType))
                                            {
                                                // console.log(task.projectType)
                                                // console.log(taskType[pos].id)
                                                if (task.projectType == taskType[pos].id)
                                                {
                                                    hasProType = true;
                                                    break;
                                                }
                                                pos = pos + 1;
                                            }
                                            // console.log(hasProType);
                                            if (hasProType)
                                            {
                                                var proTypeText = "<td>" + taskType[pos].projectType + "</td>";
                                            }
                                            else
                                            {
                                                var proTypeText = "<td> 未分类 </td>"
                                            }

                                            let str="<tr>"            
                                                + "<td>" + index + "</td>"
                                                + proTypeText
                                                + "<td>" + taskNameText + "</td>"                        
                                                + "<td>" + taskLabelText + "</td>"
                                                + "<td>" + task.signUpEndTime + "</td>"
                                                + "</tr>";

                                            $("#finishedAllTasksTable").append(str);

                                            // console.log(str)
                                        })
                                    }
                                    else
                                    {
                                        // 获取失败，显示原因
                                        console.log("拉取任务列表失败")
                                        let str="<tr><td colspan=\"5\" align=\"center\"> 暂无已截止任务 </td></tr>"
                                        $("#unfinishedAllTasksTable").append(str);
                                    }
                                }
                            })
                        }

                        // 已截止数据页码改变
                        function finishedAllTasks_lengthChange()
                        {
                            document.getElementById('finishedAllTasksTable').innerHTML = "<thead> \
                                                    <tr> \
                                                        <th>任务序号</th> \
                                                        <th>任务分类</th> \
                                                        <th>任务标题</th> \
                                                        <th>任务标签</th> \
                                                        <th>报名截止时间</th> \
                                                    </tr> \
                                                </thead> \
                                                <tbody> \
                                                </tbody>"
                            getFinishedPublicTasks()
                        }

                        // 未截止任务点击事件
                        function unfinishedAllTasksClick()
                        {
                            // 获取点击任务的id号
                            var td = event.srcElement; // 通过event.srcElement 获取激活事件的对象 td
                            if (isNaN(td.parentElement.rowIndex))
                            {
                                var tdd = td.parentElement.parentElement.rowIndex
                            }
                            else
                            {
                                var tdd = td.parentElement.rowIndex
                            }
                            // console.log(td.parentElement.rowIndex + 1)
                            // console.log(td.parentElement.children[1].innerHTML)
                            // console.log(tdd)
                            clickId = unfinishedAllTasksList[tdd - 1].id
                            // console.log(clickId)

                            toTaskInfo(clickId)
                        }

                        // 已截止任务点击事件
                        function finishedAllTasksClick()
                        {
                            // 获取点击任务的id号
                            var td = event.srcElement; // 通过event.srcElement 获取激活事件的对象 td
                            if (isNaN(td.parentElement.rowIndex))
                            {
                                var tdd = td.parentElement.parentElement.rowIndex
                            }
                            else
                            {
                                var tdd = td.parentElement.rowIndex
                            }
                            // console.log(td.parentElement.rowIndex + 1)
                            // console.log(td.parentElement.children[1].innerHTML)
                            // console.log(tdd)
                            clickId = finishedAllTasksList[tdd - 1].id
                            // console.log(clickId)

                            toTaskInfo(clickId)
                        }

                        function toTaskInfo(taskId)
                        {
                            // localStorage.setItem("nowPage", "taskInfo");
                            localStorage.setItem("taskId", taskId);
                            // console.log(localStorage.getItem("taskId"))
                            window.location.href = "index.php?nowPage=taskInfo";
                            // location.reload();
                        }
                    </script>