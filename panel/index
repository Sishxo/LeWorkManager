                    <!-- Page Heading -->
                    <h1 class="h3 mb-2 text-gray-800">任务大厅</h1>
                    <p class="mb-4">请在任务大厅中挑选自己中意的任务报名吧</p>

                    <!-- DataTale -->
                    <div class="card shadow mb-4" id="ManagerCard">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary">管理层任务</h6>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <div id="dataTable_wrapper" class="dataTables_wrapper dt-bootstrap4">

                                    <!-- 表格上方 -->
                                    <div class="row" style="margin-bottom:0.5rem">
                                        
                                        <!-- 每页显示几条 -->
                                        <div class="col-sm-12 col-md-6">
                                            <div class="dataTables_length" id="dataTable_length">
                                                <label>
                                                    <div style="display:inline-block; margin-right:5px">
                                                        <font>每页显示</font>
                                                    </div>

                                                    <div style="display:inline-block">
                                                        <select id="ManagerAllTasks_length" aria-controls="dataTable" class="custom-select custom-select-sm form-control form-control-sm" onchange="ManagerAllTasks_lengthChange()">
                                                            <option value="10">10</option>
                                                            <option value="25">25</option>
                                                            <option value="50">50</option>
                                                            <option value="100">100</option>
                                                        </select>
                                                    </div>

                                                    <div style="display:inline-block; margin-left: 5px">
                                                        <font>条</font>
                                                    </div>
                                                </label>
                                            </div>
                                        </div>

                                        <!-- 搜索框 -->
                                        <div class="col-sm-12 col-md-6">
                                            <div id="dataTable_filter" class="dataTables_filter">
                                                <label>
                                                    <div style="display:inline-block">
                                                        <font>筛选查找：</font>
                                                    </div>

                                                    <div style="display:inline-block">
                                                        <input id="ManagerCondition" type="search" class="form-control form-control-sm" aria-controls="dataTable" onKeyUp="ManagerConditionChange()">
                                                        </input>
                                                    </div>
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 表格本体 -->
                                    <div class="row">
                                        <div class="col-sm-12">    
                                            <table class="table table-bordered" id="ManagerAllTasksTable" width="100%" cellspacing="0" onclick="ManagerAllTasksClick()">
                                                <thead>
                                                    <tr>
                                                        <th width="10%">任务序号</th>
                                                        <th width="10%">任务分类</th>
                                                        <th>任务标题</th>
                                                        <th width="10%">任务标签</th>
                                                        <th width="7%">泺研币</th>
                                                        <th width="7%">泺学分</th>
                                                        <th width="15%">报名截止时间</th>
                                                        <th width="15%">任务截止时间</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <!-- 表格下方 -->
                                    <div class=row>
                                        
                                        <!-- 显示编号 -->
                                        <div class="col-sm-12 col-md-5">
                                            <label>
                                                <div style="display:inline-block; margin-right:5px">
                                                    <font>第</font>
                                                </div>

                                                <div style="display:inline-block;width:20%">
                                                    <input id="ManagerPageInput" class="form-control form-control-sm" onchange="ManagerPageInputChange()">
                                                    </input>
                                                </div>

                                                <div style="display:inline-block; margin-left: 5px">
                                                    <font>页</font>
                                                </div>
                                            </label>
                                        </div>

                                        <!-- 上一页 下一页 -->
                                        <div class="col-sm-12 col-md-7">
                                            <div class="dataTables_paginate paging_simple_numbers" id="dataTable_paginate">
                                                <ul class="pagination">
                                                    <li class="paginate_button page-item" id="dataTable_previous">
                                                        <button id="ManagerPageReduct" onclick="ManagerPageReduct()" class="page-link">
                                                            上一页
                                                        </button>
                                                    </li>
                                                    <li class="paginate_button page-item" id="dataTable_previous">
                                                        <button id="ManagerPagePlus" onclick="ManagerPagePlus()" class="page-link">
                                                            下一页
                                                        </button>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- DataTale -->
                    <div class="card shadow mb-4">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary">可报名任务</h6>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <div id="dataTable_wrapper" class="dataTables_wrapper dt-bootstrap4">

                                    <!-- 表格上方 -->
                                    <div class="row" style="margin-bottom:0.5rem">
                                        
                                        <!-- 每页显示几条 -->
                                        <div class="col-sm-12 col-md-6">
                                            <div class="dataTables_length" id="dataTable_length">
                                                <label>
                                                    <div style="display:inline-block; margin-right:5px">
                                                        <font>每页显示</font>
                                                    </div>

                                                    <div style="display:inline-block">
                                                        <select id="signUpAllTasks_length" aria-controls="dataTable" class="custom-select custom-select-sm form-control form-control-sm" onchange="signUpAllTasks_lengthChange()">
                                                            <option value="10">10</option>
                                                            <option value="25">25</option>
                                                            <option value="50">50</option>
                                                            <option value="100">100</option>
                                                        </select>
                                                    </div>

                                                    <div style="display:inline-block; margin-left: 5px">
                                                        <font>条</font>
                                                    </div>
                                                </label>
                                            </div>
                                        </div>

                                        <!-- 搜索框 -->
                                        <div class="col-sm-12 col-md-6">
                                            <div id="dataTable_filter" class="dataTables_filter">
                                                <label>
                                                    <div style="display:inline-block">
                                                        <font>筛选查找：</font>
                                                    </div>

                                                    <div style="display:inline-block">
                                                        <input id="signUpCondition" type="search" class="form-control form-control-sm" aria-controls="dataTable" onKeyUp="signUpConditionChange()">
                                                        </input>
                                                    </div>
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 表格本体 -->
                                    <div class="row">
                                        <div class="col-sm-12">    
                                            <table class="table table-bordered" id="signUpAllTasksTable" width="100%" cellspacing="0" onclick="signUpAllTasksClick()">
                                                <thead>
                                                    <tr>
                                                        <th width="10%">任务序号</th>
                                                        <th width="10%">任务分类</th>
                                                        <th>任务标题</th>
                                                        <th width="10%">任务标签</th>
                                                        <th width="7%">泺研币</th>
                                                        <th width="7%">泺学分</th>
                                                        <th width="15%">报名截止时间</th>
                                                        <th width="15%">任务截止时间</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <!-- 表格下方 -->
                                    <div class=row>
                                        
                                        <!-- 显示编号 -->
                                        <div class="col-sm-12 col-md-5">
                                            <label>
                                                <div style="display:inline-block; margin-right:5px">
                                                    <font>第</font>
                                                </div>

                                                <div style="display:inline-block;width:20%">
                                                    <input id="signUpPageInput" class="form-control form-control-sm" onchange="signUpPageInputChange()">
                                                    </input>
                                                </div>

                                                <div style="display:inline-block; margin-left: 5px">
                                                    <font>页</font>
                                                </div>
                                            </label>
                                        </div>

                                        <!-- 上一页 下一页 -->
                                        <div class="col-sm-12 col-md-7">
                                            <div class="dataTables_paginate paging_simple_numbers" id="dataTable_paginate">
                                                <ul class="pagination">
                                                    <li class="paginate_button page-item" id="dataTable_previous">
                                                        <button id="signUpPageReduct" onclick="signUpPageReduct()" class="page-link">
                                                            上一页
                                                        </button>
                                                    </li>
                                                    <li class="paginate_button page-item" id="dataTable_previous">
                                                        <button id="signUpPagePlus" onclick="signUpPagePlus()" class="page-link">
                                                            下一页
                                                        </button>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- DataTale -->
                    <div class="card shadow mb-4">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary">进行中任务</h6>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <div id="dataTable_wrapper" class="dataTables_wrapper dt-bootstrap4">

                                    <!-- 表格上方 -->
                                    <div class="row" style="margin-bottom:0.5rem">
                                        
                                        <!-- 每页显示几条 -->
                                        <div class="col-sm-12 col-md-6">
                                            <div class="dataTables_length" id="dataTable_length">
                                                <label>
                                                    <div style="display:inline-block; margin-right:5px">
                                                        <font>每页显示</font>
                                                    </div>

                                                    <div style="display:inline-block">
                                                        <select id="goingAllTasks_length" aria-controls="dataTable" class="custom-select custom-select-sm form-control form-control-sm" onchange="goingAllTasks_lengthChange()">
                                                            <option value="10">10</option>
                                                            <option value="25">25</option>
                                                            <option value="50">50</option>
                                                            <option value="100">100</option>
                                                        </select>
                                                    </div>

                                                    <div style="display:inline-block; margin-left: 5px">
                                                        <font>条</font>
                                                    </div>
                                                </label>
                                            </div>
                                        </div>

                                        <!-- 搜索框 -->
                                        <div class="col-sm-12 col-md-6">
                                            <div id="dataTable_filter" class="dataTables_filter">
                                                <label>
                                                    <div style="display:inline-block">
                                                        <font>筛选查找：</font>
                                                    </div>

                                                    <div style="display:inline-block">
                                                        <input id="goingCondition" type="search" class="form-control form-control-sm" aria-controls="dataTable" onKeyUp="goingConditionChange()">
                                                        </input>
                                                    </div>
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 表格本体 -->
                                    <div class="row">
                                        <div class="col-sm-12">    
                                            <table class="table table-bordered" id="goingAllTasksTable" width="100%" cellspacing="0" onclick="goingAllTasksClick()">
                                                <thead>
                                                    <tr>
                                                        <th width="5%">任务序号</th>
                                                        <th width="10%">任务分类</th>
                                                        <th>任务标题</th>
                                                        <th width="10%">任务标签</th>
                                                        <th width="7%">泺研币</th>
                                                        <th width="7%">泺学分</th>
                                                        <th width="15%">报名截止时间</th>
                                                        <th width="15%">任务截止时间</th>
                                                        <th width="15%">任务完成度</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <!-- 表格下方 -->
                                    <div class=row>
                                        
                                        <!-- 显示编号 -->
                                        <div class="col-sm-12 col-md-5">
                                            <label>
                                                <div style="display:inline-block; margin-right:5px">
                                                    <font>第</font>
                                                </div>

                                                <div style="display:inline-block;width:20%">
                                                    <input id="goingPageInput" class="form-control form-control-sm" onchange="goingPageInputChange()">
                                                    </input>
                                                </div>

                                                <div style="display:inline-block; margin-left: 5px">
                                                    <font>页</font>
                                                </div>
                                            </label>
                                        </div>

                                        <!-- 上一页 下一页 -->
                                        <div class="col-sm-12 col-md-7">
                                            <div class="dataTables_paginate paging_simple_numbers" id="dataTable_paginate">
                                                <ul class="pagination">
                                                    <li class="paginate_button page-item" id="dataTable_previous">
                                                        <button id="goingPageReduct" onclick="goingPageReduct()" class="page-link">
                                                            上一页
                                                        </button>
                                                    </li>
                                                    <li class="paginate_button page-item" id="dataTable_previous">
                                                        <button id="goingPagePlus" onclick="goingPagePlus()" class="page-link">
                                                            下一页
                                                        </button>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- DataTale -->
                    <div class="card shadow mb-4">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary">已完成任务</h6>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <div id="dataTable_wrapper" class="dataTables_wrapper dt-bootstrap4">

                                    <!-- 表格上方 -->
                                    <div class="row" style="margin-bottom:0.5rem">
                                        
                                        <!-- 每页显示几条 -->
                                        <div class="col-sm-12 col-md-6">
                                            <div class="dataTables_length" id="dataTable_length">
                                                <label>
                                                    <div style="display:inline-block; margin-right:5px">
                                                        <font>每页显示</font>
                                                    </div>

                                                    <div style="display:inline-block">
                                                        <select id="finishedAllTasks_length" aria-controls="dataTable" class="custom-select custom-select-sm form-control form-control-sm" onchange="finishedAllTasks_lengthChange()">
                                                            <option value="10">10</option>
                                                            <option value="25">25</option>
                                                            <option value="50">50</option>
                                                            <option value="100">100</option>
                                                        </select>
                                                    </div>

                                                    <div style="display:inline-block; margin-left: 5px">
                                                        <font>条</font>
                                                    </div>
                                                </label>
                                            </div>
                                        </div>

                                        <!-- 搜索框 -->
                                        <div class="col-sm-12 col-md-6">
                                            <div id="dataTable_filter" class="dataTables_filter">
                                                <label>
                                                    <div style="display:inline-block">
                                                        <font>筛选查找：</font>
                                                    </div>

                                                    <div style="display:inline-block">
                                                        <input id="finishedCondition" type="search" class="form-control form-control-sm" aria-controls="dataTable" onKeyUp="finishedConditionChange()">
                                                        </input>
                                                    </div>

                    
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 表格本体 -->
                                    <div class="row">
                                        <div class="col-sm-12">    
                                            <table class="table table-bordered" id="finishedAllTasksTable" width="100%" cellspacing="0" onclick="finishedAllTasksClick()">
                                                <thead>
                                                    <tr>
                                                        <th width="10%">任务序号</th>
                                                        <th width="15%">任务分类</th>
                                                        <th>任务标题</th>
                                                        <th width="10%">任务标签</th>
                                                        <th width="7%">泺研币</th>
                                                        <th width="7%">泺学分</th>
                                                        <th width="20%">任务完成时间</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <!-- 表格下方 -->
                                    <div class=row>
                                        
                                        <!-- 显示编号 -->
                                        <div class="col-sm-12 col-md-5">
                                            <label>
                                                <div style="display:inline-block; margin-right:5px">
                                                    <font>第</font>
                                                </div>

                                                <div style="display:inline-block;width:20%">
                                                    <input id="finishedPageInput" class="form-control form-control-sm" onchange="finishedPageInputChange()">
                                                    </input>
                                                </div>

                                                <div style="display:inline-block; margin-left: 5px">
                                                    <font>页</font>
                                                </div>
                                            </label>
                                        </div>

                                        <!-- 上一页 下一页 -->
                                        <div class="col-sm-12 col-md-7">
                                            <div class="dataTables_paginate paging_simple_numbers" id="dataTable_paginate">
                                                <ul class="pagination">
                                                    <li class="paginate_button page-item" id="dataTable_previous">
                                                        <button id="finishedPageReduct" onclick="finishedPageReduct()" class="page-link">
                                                            上一页
                                                        </button>
                                                    </li>
                                                    <li class="paginate_button page-item" id="dataTable_previous">
                                                        <button id="finishedPagePlus" onclick="finishedPagePlus()" class="page-link">
                                                            下一页
                                                        </button>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="maxManagerPage" style="display:none"></div>
                    <div id="maxSignUpPage" style="display:none"></div>
                    <div id="maxGoingPage" style="display:none"></div>
                    <div id="maxFinishedPage" style="display:none"></div>

                    <script type="text/javascript">
                        toastr.options.positionClass = 'toast-top-right';
                        // 初始化页码
                        var ManagerPage = 1
                        var signUpPage = 1  // 报名未截止任务页码
                        var goingPage = 1    // 报名截止任务页码
                        var finishedPage = 1

                        var userInfo = localStorage.getItem("userInfo")
                        var userInfoJson = JSON.parse(userInfo)
                        console.log(userInfoJson.permit)
                        if(userInfoJson.permit >3)
                        {
                            $("#ManagerCard").hide()
                        }

                        if(localStorage.getItem("ManagerPage"))
                        {
                            ManagerPage = localStorage.getItem("ManagerPage")
                        }
                        if (localStorage.getItem("signUpPage"))
                        {
                            signUpPage = localStorage.getItem("signUpPage")
                        }

                        if (localStorage.getItem("goingPage"))
                        {
                            goingPage = localStorage.getItem("goingPage")
                        }

                        if (localStorage.getItem("finishedPage"))
                        {
                            finishedPage = localStorage.getItem("finishedPage")
                        }

                        var oldManagerCondition = ""
                        var oldSignUpCondition = ""
                        var oldGoingCondition = ""
                        var oldFinishedCondition = ""

                        var taskType

                        $('[data-toggle="tooltip"]').tooltip()

                        // 获取任务类型
                        $.ajax({
                            contentType: "application/x-www-form-urlencoded",
                            url:"../api/getTaskType.php",
                            type: "POST",
                            data:{},
                            success:function(res){
                                // console.log(res)
                                var res_json = JSON.parse(res)
                                // console.log(res_json)
                                // console.log(res_json.code)
                                if (res_json.code == 200)
                                {
                                    // 获取成功
                                    // console.log(res_json.message)

                                    // 储存
                                    taskType = res_json.message

                                    // 回调
                                    getManagerPublicTasks()
                                    getSignUpPublicTasks()
                                    getGoingPublicTasks()
                                    getFinishedPublicTasks()
                                }
                                else
                                {
                                    // 获取失败，显示原因
                                    console.log("获取任务类型失败")
                                }
                            }
                        })

                        /* ------------- 管理层 -------------*/

                        // 获取可报名数据
                        function getManagerPublicTasks()
                        {
                            // console.log($('#signUpAllTasks_length option:selected').val())

                            $.ajax({
                                contentType: "application/x-www-form-urlencoded",
                                url:"../api/ManagerAllTasks.php",
                                type: "POST",
                                data:{
                                    page: ManagerPage,
                                    length: $('#ManagerAllTasks_length option:selected').val(),
                                    ManagerCondition: document.getElementById("ManagerCondition").value
                                },
                                success:function(res){
                                    // console.log(res)
                                    var res_json = JSON.parse(res)
                                    // console.log(res_json)
                                    // console.log(res_json.code)
                                    if (res_json.code == 200)
                                    {
                                        // 获取成功
                                        // console.log(res_json.message)
                                        // console.log(taskType['0'].projectType)
                                        ManagerAllTasksList = res_json.message

                                        // 显示到下拉菜单
                                        $.each(res_json.message, function(i, task) {
                                            // 显示标签
                                            var taskLabelText = ""
                                            $.each(task.labels, function(i, taskLabel) {
                                                // console.log(taskLabel.label)
                                                taskLabelText = taskLabelText + "<span class=\"label label-info\">" + taskLabel.label + "</span>&nbsp;"
                                                // console.log(taskLabelText)
                                            })

                                            // console.log(task)
                                            var index = (ManagerPage - 1) * $('#ManagerAllTasks_length option:selected').val() + Number(i) + 1
                                            // console.log(index)
                                            
                                            // console.log(task.projectType)
                                            // console.log(taskType['0'])
                                            // console.log(taskType[task.projectType - 1])
                                            // console.log(taskType[task.projectType - 1].projectType)

                                            // 显示提示框
                                            // taskNameText = "<span data-toggle=\"tooltip\" data-placement=\"right\" title=\"" + task.introduction + "\">" + task.proName + "</span>"
                                            
                                            // 判断后面的标签
                                            var nowDateTime = getCurrentTime(1)
                                            var nearDateTime = getCurrentTime(2)
                                            var lastDateTime = getCurrentTime(3)
                                            // console.log(nowDateTime)
                                            // console.log(nearDateTime)
                                            // console.log(task.endTime)
                                            // 加徽章
                                            if (task.createTime > lastDateTime)
                                            {
                                                // console.log(task.createTime)
                                                // console.log(lastDateTime)
                                                // console.log(task.proName)
                                                taskNameText = task.proName + "&nbsp;<span class=\"badge badge-success\">新任务</span>"
                                            }
                                            else
                                            {
                                                // 正常
                                                taskNameText = task.proName
                                            }

                                            // 报名过期临期
                                            if (task.havePersonSignUp == 0)
                                            {
                                                // 过期无人报名
                                                taskNameText = taskNameText + "&nbsp;<span class=\"badge badge-danger\">过期无人报名</span>"
                                            }
                                            else if (nearDateTime > task.signUpEndTime)
                                            {
                                                // 临期
                                                taskNameText = taskNameText + "&nbsp;<span class=\"badge badge-warning\">报名临期</span>"
                                            }

                                            if (nowDateTime > task.endTime)
                                            {
                                                // 延期
                                                taskNameText = taskNameText + "&nbsp;<span class=\"badge badge-danger\">延期</span>"
                                            }
                                            else if (nearDateTime > task.endTime)
                                            {
                                                // 临期
                                                taskNameText = taskNameText + "&nbsp;<span class=\"badge badge-warning\">临期</span>"
                                            }

                                            // 查找任务类型
                                            var pos = 0;
                                            var hasProType = false;
                                            while (pos < getJsonLength(taskType))
                                            {
                                                // console.log(task.projectType)
                                                // console.log(taskType[pos].id)
                                                if (task.projectType == taskType[pos].id)
                                                {
                                                    hasProType = true;
                                                    break;
                                                }
                                                pos = pos + 1;
                                            }
                                            // console.log(hasProType);
                                            if (hasProType)
                                            {
                                                var proTypeText = "<td>" + taskType[pos].projectType + "</td>";
                                            }
                                            else
                                            {
                                                var proTypeText = "<td> 未分类 </td>"
                                            }

                                            // console.log(taskNameText)
                                            // console.log(task.taskMoney)

                                            let str="<tr>"            
                                                + "<td>" + index + "</td>"
                                                + proTypeText
                                                + "<td>" + taskNameText + "</td>"                        
                                                + "<td>" + taskLabelText + "</td>"
                                                + "<td>" + task.taskMoney + "</td>"
                                                + "<td>" + task.taskPoint + "</td>"
                                                + "<td>" + task.signUpEndTime + "</td>"
                                                + "<td>" + task.endTime + "</td>"
                                                + "</tr>";

                                            $("#ManagerAllTasksTable").append(str);
                                            // console.log(str)
                                        })

                                        // 翻页按钮禁用判断
                                        if (ManagerPage == 1)
                                        {
                                            document.getElementById('ManagerPageReduct').disabled = "disabled"
                                            document.getElementById('ManagerPageReduct').className = "page-link disabled"
                                        }
                                        else
                                        {
                                            document.getElementById('ManagerPageReduct').disabled = ""
                                            document.getElementById('ManagerPageReduct').className = "page-link"
                                        }

                                        var maxManagerPage = Math.ceil(Number(res_json.listLength) / Number($('#ManagerAllTasks_length option:selected').val()))

                                        if (ManagerPage >= maxManagerPage)
                                        {
                                            document.getElementById('ManagerPagePlus').disabled = "disabled"
                                            document.getElementById('ManagerPagePlus').className = "page-link disabled"
                                        }
                                        else
                                        {
                                            document.getElementById('ManagerPagePlus').disabled = ""
                                            document.getElementById('ManagerPagePlus').className = "page-link"
                                        }

                                        // 页码填进去框里
                                        document.getElementById('ManagerPageInput').value = ManagerPage
                                        document.getElementById('ManagerPageInput').disabled = ""
                                        document.getElementById('maxManagerPage').innerHTML = maxManagerPage
                                    }
                                    else
                                    {
                                        // 获取失败，显示原因
                                        console.log("拉取任务列表失败")
                                        document.getElementById('maxManagerPage').innerHTML = 0
                                        document.getElementById('ManagerPageInput').disabled = "disabled"
                                        document.getElementById('ManagerPageInput').value = ""
                                        document.getElementById('ManagerPageReduct').disabled = "disabled"
                                        document.getElementById('ManagerPageReduct').className = "page-link disabled"
                                        document.getElementById('ManagerPagePlus').disabled = "disabled"
                                        document.getElementById('ManagerPagePlus').className = "page-link disabled"
                                        let str="<tr><td colspan=\"8\" align=\"center\"> 暂无管理层任务 </td></tr>"
                                        $("#ManagerAllTasksTable").append(str);
                                    }
                                }
                            })
                        }

                        // 可报名数据页码改变
                        function ManagerAllTasks_lengthChange()
                        {
                            ManagerPage = 1
                            ManagerAllTasksReload()
                        }

                        // 可报名数据重加载
                        function ManagerAllTasksReload()
                        {
                            document.getElementById('ManagerAllTasksTable').innerHTML = "<thead> \
                                                    <tr> \
                                                        <th width=\"10%\">任务序号</th> \
                                                        <th width=\"10%\">任务分类</th> \
                                                        <th>任务标题</th> \
                                                        <th width=\"10%\">任务标签</th> \
                                                        <th width=\"7%\">泺研币</th> \
                                                        <th width=\"7%\">泺学分</th> \
                                                        <th width=\"15%\">报名截止时间</th> \
                                                        <th width=\"15%\">任务截止时间</th> \
                                                    </tr> \
                                                </thead> \
                                                <tbody> \
                                                </tbody>"
                            getManagerPublicTasks()
                        }

                        // 可报名任务点击事件
                        function ManagerAllTasksClick()
                        {
                            // 获取点击任务的id号
                            var td = event.srcElement; // 通过event.srcElement 获取激活事件的对象 td
                            if (isNaN(td.parentElement.rowIndex))
                            {
                                var tdd = td.parentElement.parentElement.rowIndex
                            }
                            else
                            {
                                var tdd = td.parentElement.rowIndex
                            }
                            // console.log(td.parentElement.rowIndex + 1)
                            // console.log(td.parentElement.children[1].innerHTML)
                            // console.log(tdd)
                            // console.log(document.getElementById('maxSignUpPage').innerHTML)
                            if ((tdd > 0) && (document.getElementById('maxManagerPage').innerHTML > 0))
                            {
                                clickId = ManagerAllTasksList[tdd - 1].id
                                // console.log(clickId)
                                localStorage.setItem("fromPage", "index")
                                localStorage.setItem("ManagerPage", ManagerPage)
                                toTaskInfo(clickId)
                            }
                        }

                        // 可报名筛选条件改变
                        function ManagerConditionChange()
                        {
                            var nowManagerCondition = document.getElementById("ManagerCondition").value

                            if (oldManagerCondition != nowManagerCondition)
                            {
                                ManagerAllTasksReload()

                                oldManagerCondition = nowManagerCondition
                            }
                        }

                        // 页码加减
                        function ManagerPageReduct()
                        {
                            ManagerPage = ManagerPage - 1
                            ManagerAllTasksReload()
                        }

                        function ManagerPagePlus()
                        {
                            Page = ManagerPage + 1
                            ManagerAllTasksReload()
                        }

                        // 可报名任务页码突变
                        function ManagerPageInputChange()
                        {
                            if (!(/(^[0-9]*[1-9][0-9]*$)/.test(document.getElementById('ManagerPageInput').value)))
                            {
                                // 非正整数
                                if (document.getElementById('maxManagerPage').innerHTML == 0)
                                {
                                    document.getElementById('ManagerPageInput').value = ""
                                }
                                else
                                {
                                    document.getElementById('ManagerPageInput').value = ManagerPage
                                }

                                toastr.error("页码格式错误")
                            }
                            else if (document.getElementById('ManagerPageInput').value > document.getElementById('maxManagerPage').innerHTML)
                            {
                                // 页码超出了最大页
                                if (document.getElementById('maxManagerPage').innerHTML == 0)
                                {
                                    document.getElementById('ManagerPageInput').value = ""
                                }
                                else
                                {
                                    document.getElementById('ManagerPageInput').value = ManagerPage
                                }

                                toastr.error("页码已超出总数")
                            }
                            else
                            {
                                ManagerPage = Number(document.getElementById('ManagerPageInput').value)
                                ManagerAllTasksReload()
                            }
                        }

                        /* ------------- 可报名 -------------*/

                        // 获取可报名数据
                        function getSignUpPublicTasks()
                        {
                            // console.log($('#signUpAllTasks_length option:selected').val())

                            $.ajax({
                                contentType: "application/x-www-form-urlencoded",
                                url:"../api/signUpAllTasks.php",
                                type: "POST",
                                data:{
                                    page: signUpPage,
                                    length: $('#signUpAllTasks_length option:selected').val(),
                                    signUpCondition: document.getElementById("signUpCondition").value
                                },
                                success:function(res){
                                    // console.log(res)
                                    var res_json = JSON.parse(res)
                                    // console.log(res_json)
                                    // console.log(res_json.code)
                                    if (res_json.code == 200)
                                    {
                                        // 获取成功
                                        // console.log(res_json.message)
                                        // console.log(taskType['0'].projectType)
                                        signUpAllTasksList = res_json.message

                                        // 显示到下拉菜单
                                        $.each(res_json.message, function(i, task) {
                                            // 显示标签
                                            var taskLabelText = ""
                                            $.each(task.labels, function(i, taskLabel) {
                                                // console.log(taskLabel.label)
                                                taskLabelText = taskLabelText + "<span class=\"label label-info\">" + taskLabel.label + "</span>&nbsp;"
                                                // console.log(taskLabelText)
                                            })

                                            // console.log(task)
                                            var index = (signUpPage - 1) * $('#signUpAllTasks_length option:selected').val() + Number(i) + 1
                                            // console.log(index)
                                            
                                            // console.log(task.projectType)
                                            // console.log(taskType['0'])
                                            // console.log(taskType[task.projectType - 1])
                                            // console.log(taskType[task.projectType - 1].projectType)

                                            // 显示提示框
                                            // taskNameText = "<span data-toggle=\"tooltip\" data-placement=\"right\" title=\"" + task.introduction + "\">" + task.proName + "</span>"
                                            
                                            // 判断后面的标签
                                            var nowDateTime = getCurrentTime(1)
                                            var nearDateTime = getCurrentTime(2)
                                            var lastDateTime = getCurrentTime(3)
                                            // console.log(nowDateTime)
                                            // console.log(nearDateTime)
                                            // console.log(task.endTime)
                                            // 加徽章
                                            if (task.createTime > lastDateTime)
                                            {
                                                // console.log(task.createTime)
                                                // console.log(lastDateTime)
                                                // console.log(task.proName)
                                                taskNameText = task.proName + "&nbsp;<span class=\"badge badge-success\">新任务</span>"
                                            }
                                            else
                                            {
                                                // 正常
                                                taskNameText = task.proName
                                            }

                                            // 报名过期临期
                                            if (task.havePersonSignUp == 0)
                                            {
                                                // 过期无人报名
                                                taskNameText = taskNameText + "&nbsp;<span class=\"badge badge-danger\">过期无人报名</span>"
                                            }
                                            else if (nearDateTime > task.signUpEndTime)
                                            {
                                                // 临期
                                                taskNameText = taskNameText + "&nbsp;<span class=\"badge badge-warning\">报名临期</span>"
                                            }

                                            if (nowDateTime > task.endTime)
                                            {
                                                // 延期
                                                taskNameText = taskNameText + "&nbsp;<span class=\"badge badge-danger\">延期</span>"
                                            }
                                            else if (nearDateTime > task.endTime)
                                            {
                                                // 临期
                                                taskNameText = taskNameText + "&nbsp;<span class=\"badge badge-warning\">临期</span>"
                                            }

                                            // 查找任务类型
                                            var pos = 0;
                                            var hasProType = false;
                                            while (pos < getJsonLength(taskType))
                                            {
                                                // console.log(task.projectType)
                                                // console.log(taskType[pos].id)
                                                if (task.projectType == taskType[pos].id)
                                                {
                                                    hasProType = true;
                                                    break;
                                                }
                                                pos = pos + 1;
                                            }
                                            // console.log(hasProType);
                                            if (hasProType)
                                            {
                                                var proTypeText = "<td>" + taskType[pos].projectType + "</td>";
                                            }
                                            else
                                            {
                                                var proTypeText = "<td> 未分类 </td>"
                                            }

                                            // console.log(taskNameText)
                                            // console.log(task.taskMoney)

                                            let str="<tr>"            
                                                + "<td>" + index + "</td>"
                                                + proTypeText
                                                + "<td>" + taskNameText + "</td>"                        
                                                + "<td>" + taskLabelText + "</td>"
                                                + "<td>" + task.taskMoney + "</td>"
                                                + "<td>" + task.taskPoint + "</td>"
                                                + "<td>" + task.signUpEndTime + "</td>"
                                                + "<td>" + task.endTime + "</td>"
                                                + "</tr>";

                                            $("#signUpAllTasksTable").append(str);
                                            // console.log(str)
                                        })

                                        // 翻页按钮禁用判断
                                        if (signUpPage == 1)
                                        {
                                            document.getElementById('signUpPageReduct').disabled = "disabled"
                                            document.getElementById('signUpPageReduct').className = "page-link disabled"
                                        }
                                        else
                                        {
                                            document.getElementById('signUpPageReduct').disabled = ""
                                            document.getElementById('signUpPageReduct').className = "page-link"
                                        }

                                        var maxSignUpPage = Math.ceil(Number(res_json.listLength) / Number($('#signUpAllTasks_length option:selected').val()))

                                        if (signUpPage >= maxSignUpPage)
                                        {
                                            document.getElementById('signUpPagePlus').disabled = "disabled"
                                            document.getElementById('signUpPagePlus').className = "page-link disabled"
                                        }
                                        else
                                        {
                                            document.getElementById('signUpPagePlus').disabled = ""
                                            document.getElementById('signUpPagePlus').className = "page-link"
                                        }

                                        // 页码填进去框里
                                        document.getElementById('signUpPageInput').value = signUpPage
                                        document.getElementById('signUpPageInput').disabled = ""
                                        document.getElementById('maxSignUpPage').innerHTML = maxSignUpPage
                                    }
                                    else
                                    {
                                        // 获取失败，显示原因
                                        console.log("拉取任务列表失败")
                                        document.getElementById('maxSignUpPage').innerHTML = 0
                                        document.getElementById('signUpPageInput').disabled = "disabled"
                                        document.getElementById('signUpPageInput').value = ""
                                        document.getElementById('signUpPageReduct').disabled = "disabled"
                                        document.getElementById('signUpPageReduct').className = "page-link disabled"
                                        document.getElementById('signUpPagePlus').disabled = "disabled"
                                        document.getElementById('signUpPagePlus').className = "page-link disabled"
                                        let str="<tr><td colspan=\"8\" align=\"center\"> 暂无可报名任务 </td></tr>"
                                        $("#signUpAllTasksTable").append(str);
                                    }
                                }
                            })
                        }

                        // 可报名数据页码改变
                        function signUpAllTasks_lengthChange()
                        {
                            signUpPage = 1
                            signUpAllTasksReload()
                        }

                        // 可报名数据重加载
                        function signUpAllTasksReload()
                        {
                            document.getElementById('signUpAllTasksTable').innerHTML = "<thead> \
                                                    <tr> \
                                                        <th width=\"10%\">任务序号</th> \
                                                        <th width=\"10%\">任务分类</th> \
                                                        <th>任务标题</th> \
                                                        <th width=\"10%\">任务标签</th> \
                                                        <th width=\"7%\">泺研币</th> \
                                                        <th width=\"7%\">泺学分</th> \
                                                        <th width=\"15%\">报名截止时间</th> \
                                                        <th width=\"15%\">任务截止时间</th> \
                                                    </tr> \
                                                </thead> \
                                                <tbody> \
                                                </tbody>"
                            getSignUpPublicTasks()
                        }

                        // 可报名任务点击事件
                        function signUpAllTasksClick()
                        {
                            // 获取点击任务的id号
                            var td = event.srcElement; // 通过event.srcElement 获取激活事件的对象 td
                            if (isNaN(td.parentElement.rowIndex))
                            {
                                var tdd = td.parentElement.parentElement.rowIndex
                            }
                            else
                            {
                                var tdd = td.parentElement.rowIndex
                            }
                            // console.log(td.parentElement.rowIndex + 1)
                            // console.log(td.parentElement.children[1].innerHTML)
                            // console.log(tdd)
                            // console.log(document.getElementById('maxSignUpPage').innerHTML)
                            if ((tdd > 0) && (document.getElementById('maxSignUpPage').innerHTML > 0))
                            {
                                clickId = signUpAllTasksList[tdd - 1].id
                                // console.log(clickId)
                                localStorage.setItem("fromPage", "index")
                                localStorage.setItem("signUpPage", signUpPage)
                                toTaskInfo(clickId)
                            }
                        }

                        // 可报名筛选条件改变
                        function signUpConditionChange()
                        {
                            var nowSignUpCondition = document.getElementById("signUpCondition").value

                            if (oldSignUpCondition != nowSignUpCondition)
                            {
                                signUpAllTasksReload()

                                oldSignUpCondition = nowSignUpCondition
                            }
                        }

                        // 页码加减
                        function signUpPageReduct()
                        {
                            signUpPage = signUpPage - 1
                            signUpAllTasksReload()
                        }

                        function signUpPagePlus()
                        {
                            signUpPage = signUpPage + 1
                            signUpAllTasksReload()
                        }

                        // 可报名任务页码突变
                        function signUpPageInputChange()
                        {
                            if (!(/(^[0-9]*[1-9][0-9]*$)/.test(document.getElementById('signUpPageInput').value)))
                            {
                                // 非正整数
                                if (document.getElementById('maxSignUpPage').innerHTML == 0)
                                {
                                    document.getElementById('signUpPageInput').value = ""
                                }
                                else
                                {
                                    document.getElementById('signUpPageInput').value = signUpPage
                                }

                                toastr.error("页码格式错误")
                            }
                            else if (document.getElementById('signUpPageInput').value > document.getElementById('maxSignUpPage').innerHTML)
                            {
                                // 页码超出了最大页
                                if (document.getElementById('maxSignUpPage').innerHTML == 0)
                                {
                                    document.getElementById('signUpPageInput').value = ""
                                }
                                else
                                {
                                    document.getElementById('signUpPageInput').value = signUpPage
                                }

                                toastr.error("页码已超出总数")
                            }
                            else
                            {
                                signUpPage = Number(document.getElementById('signUpPageInput').value)
                                signUpAllTasksReload()
                            }
                        }

                        /* ------------- 可报名 -------------*/

                        /* ------------- 进行中 -------------*/

                        // 获取进行中数据
                        function getGoingPublicTasks()
                        {
                            // console.log($('#goingAllTasks_length option:selected').val())

                            $.ajax({
                                contentType: "application/x-www-form-urlencoded",
                                url:"../api/goingAllTasks.php",
                                type: "POST",
                                data:{
                                    page: goingPage,
                                    length: $('#goingAllTasks_length option:selected').val(),
                                    goingCondition: document.getElementById("goingCondition").value
                                },
                                success:function(res){
                                    // console.log(res)
                                    var res_json = JSON.parse(res)
                                    // console.log(res_json)
                                    // console.log(res_json.code)
                                    if (res_json.code == 200)
                                    {
                                        // 获取成功
                                        // console.log(res_json.message)
                                        // console.log(taskType['0'].projectType)
                                        goingAllTasksList = res_json.message

                                        // 显示到下拉菜单
                                        $.each(res_json.message, function(i, task) {
                                            // 显示标签
                                            var taskLabelText = ""
                                            $.each(task.labels, function(i, taskLabel) {
                                                // console.log(taskLabel.label)
                                                taskLabelText = taskLabelText + "<span class=\"label label-info\">" + taskLabel.label + "</span>&nbsp;"
                                                // console.log(taskLabelText)
                                            })

                                            // console.log(task)
                                            var index = (goingPage - 1) * $('#goingAllTasks_length option:selected').val() + Number(i) + 1
                                            // console.log(index)
                                            
                                            // console.log(task.projectType)
                                            // console.log(taskType['0'])
                                            // console.log(taskType[task.projectType - 1])
                                            // console.log(taskType[task.projectType - 1].projectType)

                                            // 显示提示框
                                            // taskNameText = "<span data-toggle=\"tooltip\" data-placement=\"right\" title=\"" + task.introduction + "\">" + task.proName + "</span>"
                                            
                                            // 判断后面的标签
                                            var nowDateTime = getCurrentTime(1)
                                            var nearDateTime = getCurrentTime(2)
                                            var lastDateTime = getCurrentTime(3)
                                            // console.log(nowDateTime)
                                            // console.log(nearDateTime)
                                            // console.log(task.endTime)
                                            // 加徽章
                                            if (task.createTime > lastDateTime)
                                            {
                                                taskNameText = task.proName + "&nbsp;<span class=\"badge badge-success\">新任务</span>"
                                            }
                                            else
                                            {
                                                // 正常
                                                taskNameText = task.proName
                                            }

                                            // 加徽章
                                            if (nowDateTime > task.endTime)
                                            {
                                                // 延期
                                                taskNameText = taskNameText + "&nbsp;<span class=\"badge badge-danger\">延期</span>"
                                            }
                                            else if (nearDateTime > task.endTime)
                                            {
                                                // 临期
                                                taskNameText = taskNameText + "&nbsp;<span class=\"badge badge-warning\">临期</span>"
                                            }

                                            // console.log(taskNameText)

                                            // 查找任务类型
                                            var pos = 0;
                                            var hasProType = false;
                                            while (pos < getJsonLength(taskType))
                                            {
                                                // console.log(task.projectType)
                                                // console.log(taskType[pos].id)
                                                if (task.projectType == taskType[pos].id)
                                                {
                                                    hasProType = true;
                                                    break;
                                                }
                                                pos = pos + 1;
                                            }
                                            // console.log(hasProType);
                                            if (hasProType)
                                            {
                                                var proTypeText = "<td>" + taskType[pos].projectType + "</td>";
                                            }
                                            else
                                            {
                                                var proTypeText = "<td> 未分类 </td>"
                                            }

                                            // 任务进度
                                            var taskPercentText = "<td style=\"vertical-align:middle\"> <div class=\"progress\"> \
                                                    <div class=\"progress-bar\" role=\"progressbar\" style=\"width:" + task.maxPercent + "%;\" aria-valuenow=\"" + task.maxPercent + "\" aria-valuemin=\"0\" aria-valuemax=\"100\">" + task.maxPercent + "%</div> \
                                                   </div> </td>"

                                            let str="<tr>"            
                                                + "<td>" + index + "</td>"
                                                + proTypeText
                                                + "<td>" + taskNameText + "</td>"                        
                                                + "<td>" + taskLabelText + "</td>"
                                                + "<td>" + task.taskMoney + "</td>"
                                                + "<td>" + task.taskPoint + "</td>"
                                                + "<td>" + task.signUpEndTime+ "</td>"  
                                                + "<td>" + task.endTime + "</td>"
                                                + taskPercentText
                                                + "</tr>";

                                            $("#goingAllTasksTable").append(str);
                                            // console.log(str)
                                        })
                                        
                                        // 翻页按钮禁用判断
                                        if (goingPage == 1)
                                        {
                                            document.getElementById('goingPageReduct').disabled = "disabled"
                                            document.getElementById('goingPageReduct').className = "page-link disabled"
                                        }
                                        else
                                        {
                                            document.getElementById('goingPageReduct').disabled = ""
                                            document.getElementById('goingPageReduct').className = "page-link"
                                        }

                                        var maxGoingPage = Math.ceil(Number(res_json.listLength) / Number($('#goingAllTasks_length option:selected').val()))
                                        // console.log(res_json.listLength)
                                        // console.log(maxGoingPage)

                                        if (goingPage >= maxGoingPage)
                                        {
                                            document.getElementById('goingPagePlus').disabled = "disabled"
                                            document.getElementById('goingPagePlus').className = "page-link disabled"
                                        }
                                        else
                                        {
                                            document.getElementById('goingPagePlus').disabled = ""
                                            document.getElementById('goingPagePlus').className = "page-link"
                                        }

                                        // 页码填进去框里
                                        document.getElementById('goingPageInput').value = goingPage
                                        // console.log(maxGoingPage)
                                        document.getElementById('goingPageInput').disabled = ""
                                        document.getElementById('maxGoingPage').innerHTML = maxGoingPage
                                    }
                                    else
                                    {
                                        // 获取失败，显示原因
                                        console.log("拉取任务列表失败")
                                        document.getElementById('maxGoingPage').innerHTML = 0
                                        document.getElementById('goingPageInput').disabled = "disabled"
                                        document.getElementById('goingPageInput').value = ""
                                        document.getElementById('goingPageReduct').disabled = "disabled"
                                        document.getElementById('goingPageReduct').className = "page-link disabled"
                                        document.getElementById('goingPagePlus').disabled = "disabled"
                                        document.getElementById('goingPagePlus').className = "page-link disabled"
                                        let str="<tr><td colspan=\"9\" align=\"center\"> 暂无进行中任务 </td></tr>"
                                        $("#goingAllTasksTable").append(str);
                                    }
                                }
                            })
                        }

                        // 进行中数据页码改变
                        function goingAllTasks_lengthChange()
                        {
                            goingPage = 1
                            goingAllTasksReload()
                        }

                        // 进行中数据重加载
                        function goingAllTasksReload()
                        {
                            document.getElementById('goingAllTasksTable').innerHTML = "<thead> \
                                                    <tr> \
                                                        <th width=\"5%\">任务序号</th> \
                                                        <th width=\"10%\">任务分类</th> \
                                                        <th>任务标题</th> \
                                                        <th width=\"10%\">任务标签</th> \
                                                        <th width=\"7%\">泺研币</th> \
                                                        <th width=\"7%\">泺学分</th> \
                                                        <th width=\"15%\">报名截止时间</th> \
                                                        <th width=\"15%\">任务截止时间</th> \
                                                        <th width=\"15%\">任务完成度</th> \
                                                    </tr> \
                                                </thead> \
                                                <tbody> \
                                                </tbody>"
                            getGoingPublicTasks()
                        }

                        // 进行中任务点击事件
                        function goingAllTasksClick()
                        {
                            // 获取点击任务的id号
                            var td = event.srcElement; // 通过event.srcElement 获取激活事件的对象 td
                            if (isNaN(td.parentElement.rowIndex))
                            {
                                var tdd = td.parentElement.parentElement.rowIndex
                            }
                            else
                            {
                                var tdd = td.parentElement.rowIndex
                            }
                            // console.log(td.parentElement.rowIndex + 1)
                            // console.log(td.parentElement.children[1].innerHTML)
                            // console.log(tdd)
                            if ((tdd > 0) && (document.getElementById('maxGoingPage').innerHTML > 0))
                            {
                                clickId = goingAllTasksList[tdd - 1].id
                                // console.log(clickId)
                                localStorage.setItem("fromPage", "index")
                                localStorage.setItem("goingPage", goingPage)
                                toTaskInfo(clickId)
                            }
                        }

                        // 进行中筛选条件改变
                        function goingConditionChange()
                        {
                            var nowGoingCondition = document.getElementById("goingCondition").value

                            if (oldGoingCondition != nowGoingCondition)
                            {
                                goingAllTasksReload()

                                oldGoingCondition = nowGoingCondition
                            }
                        }

                        // 页码加减
                        function goingPageReduct()
                        {
                            goingPage = goingPage - 1
                            goingAllTasksReload()
                        }

                        function goingPagePlus()
                        {
                            goingPage = goingPage + 1
                            goingAllTasksReload()
                        }

                        // 进行中任务页码突变
                        function goingPageInputChange()
                        {
                            if (!(/(^[0-9]*[1-9][0-9]*$)/.test(document.getElementById('goingPageInput').value)))
                            {
                                // 非正整数
                                if (document.getElementById('maxGoingPage').innerHTML == 0)
                                {
                                    document.getElementById('goingPageInput').value = ""
                                }
                                else
                                {
                                    document.getElementById('goingPageInput').value = goingPage
                                }

                                toastr.error("页码格式错误")
                            }
                            else if (document.getElementById('goingPageInput').value > document.getElementById('maxGoingPage').innerHTML)
                            {
                                // 页码超出了最大页
                                if (document.getElementById('maxGoingPage').innerHTML == 0)
                                {
                                    document.getElementById('goingPageInput').value = ""
                                }
                                else
                                {
                                    document.getElementById('goingPageInput').value = goingPage
                                }

                                toastr.error("页码已超出总数")
                            }
                            else
                            {
                                goingPage = Number(document.getElementById('goingPageInput').value)
                                goingAllTasksReload()
                            }
                        }

                        /* ------------- 进行中 -------------*/

                        /* ------------- 已完成 -------------*/

                        // 获取已完成数据
                        function getFinishedPublicTasks()
                        {
                            // console.log($('#finishedAllTasks_length option:selected').val())

                            $.ajax({
                                contentType: "application/x-www-form-urlencoded",
                                url:"../api/finishedAllTasks.php",
                                type: "POST",
                                data:{
                                    page: finishedPage,
                                    length: $('#finishedAllTasks_length option:selected').val(),
                                    finishedCondition: document.getElementById("finishedCondition").value
                                },
                                success:function(res){
                                    // console.log(res)
                                    var res_json = JSON.parse(res)
                                    // console.log(res_json)
                                    // console.log(res_json.code)
                                    if (res_json.code == 200)
                                    {
                                        // 获取成功
                                        // console.log(res_json.message)
                                        // console.log(taskType['0'].projectType)
                                        finishedAllTasksList = res_json.message

                                        // 显示到下拉菜单
                                        $.each(res_json.message, function(i, task) {
                                            // 显示标签
                                            var taskLabelText = ""
                                            $.each(task.labels, function(i, taskLabel) {
                                                // console.log(taskLabel.label)
                                                taskLabelText = taskLabelText + "<span class=\"label label-info\">" + taskLabel.label + "</span>&nbsp;"
                                                // console.log(taskLabelText)
                                            })

                                            // console.log(task)
                                            var index = (finishedPage - 1) * $('#finishedAllTasks_length option:selected').val() + Number(i) + 1
                                            // console.log(index)
                                            
                                            // console.log(task.projectType)
                                            // console.log(taskType['0'])
                                            // console.log(taskType[task.projectType - 1])
                                            // console.log(taskType[task.projectType - 1].projectType)

                                            // 显示提示框
                                            // taskNameText = "<span data-toggle=\"tooltip\" data-placement=\"right\" title=\"" + task.introduction + "\">" + task.proName + "</span>"
                                            
                                            // 判断后面的标签
                                            var lastDateTime = getCurrentTime(3)
                                            // 加徽章
                                            if (task.createTime > lastDateTime)
                                            {
                                                taskNameText = task.proName + "&nbsp;<span class=\"badge badge-success\">新任务</span>"
                                            }
                                            else
                                            {
                                                // 正常
                                                taskNameText = task.proName
                                            }

                                            // 加徽章
                                            if (task.realEndTime > task.endTime)
                                            {
                                                // 延期
                                                taskNameText = taskNameText + "&nbsp;<span class=\"badge badge-danger\">延期</span>"
                                            }
                                            else if (task.endTime > task.realEndTime)
                                            {
                                                // 提前完成
                                                taskNameText = taskNameText + "&nbsp;<span class=\"badge badge-success\">提前</span>"
                                            }

                                            // console.log(taskNameText)

                                            // 查找任务类型
                                            var pos = 0;
                                            var hasProType = false;
                                            while (pos < getJsonLength(taskType))
                                            {
                                                // console.log(task.projectType)
                                                // console.log(taskType[pos].id)
                                                if (task.projectType == taskType[pos].id)
                                                {
                                                    hasProType = true;
                                                    break;
                                                }
                                                pos = pos + 1;
                                            }
                                            // console.log(hasProType);
                                            if (hasProType)
                                            {
                                                var proTypeText = "<td>" + taskType[pos].projectType + "</td>";
                                            }
                                            else
                                            {
                                                var proTypeText = "<td> 未分类 </td>"
                                            }

                                            let str="<tr>"            
                                                + "<td>" + index + "</td>"
                                                + proTypeText
                                                + "<td>" + taskNameText + "</td>"                        
                                                + "<td>" + taskLabelText + "</td>"
                                                + "<td>" + task.taskMoney + "</td>"
                                                + "<td>" + task.taskPoint + "</td>"
                                                + "<td>" + task.realEndTime + "</td>"
                                                + "</tr>";

                                            $("#finishedAllTasksTable").append(str);
                                            // console.log(str)
                                        })

                                        // 翻页按钮禁用判断
                                        if (finishedPage == 1)
                                        {
                                            document.getElementById('finishedPageReduct').disabled = "disabled"
                                            document.getElementById('finishedPageReduct').className = "page-link disabled"
                                        }
                                        else
                                        {
                                            document.getElementById('finishedPageReduct').disabled = ""
                                            document.getElementById('finishedPageReduct').className = "page-link"
                                        }

                                        var maxFinishedPage = Math.ceil(Number(res_json.listLength) / Number($('#finishedAllTasks_length option:selected').val()))

                                        if (finishedPage >= maxFinishedPage)
                                        {
                                            document.getElementById('finishedPagePlus').disabled = "disabled"
                                            document.getElementById('finishedPagePlus').className = "page-link disabled"
                                        }
                                        else
                                        {
                                            document.getElementById('finishedPagePlus').disabled = ""
                                            document.getElementById('finishedPagePlus').className = "page-link"
                                        }

                                        // 页码填进去框里
                                        document.getElementById('finishedPageInput').value = finishedPage
                                        document.getElementById('finishedPageInput').disabled = ""
                                        document.getElementById('maxFinishedPage').innerHTML = maxFinishedPage
                                    }
                                    else
                                    {
                                        // 获取失败，显示原因
                                        console.log("拉取任务列表失败")
                                        document.getElementById('maxFinishedPage').innerHTML = 0
                                        document.getElementById('finishedPageInput').disabled = "disabled"
                                        document.getElementById('finishedPageInput').value = ""
                                        document.getElementById('finishedPageReduct').disabled = "disabled"
                                        document.getElementById('finishedPageReduct').className = "page-link disabled"
                                        document.getElementById('finishedPagePlus').disabled = "disabled"
                                        document.getElementById('finishedPagePlus').className = "page-link disabled"
                                        let str="<tr><td colspan=\"7\" align=\"center\"> 暂无已完成任务 </td></tr>"
                                        $("#finishedAllTasksTable").append(str);
                                    }
                                }
                            })
                        }

                        // 已完成数据页码改变
                        function finishedAllTasks_lengthChange()
                        {
                            finishedPage = 1
                            finishedAllTasksReload()
                        }

                        // 已完成数据重加载
                        function finishedAllTasksReload()
                        {
                            document.getElementById('finishedAllTasksTable').innerHTML = "<thead> \
                                                    <tr> \
                                                        <th width=\"10%\">任务序号</th> \
                                                        <th width=\"15%\">任务分类</th> \
                                                        <th>任务标题</th> \
                                                        <th width=\"10%\">任务标签</th> \
                                                        <th width=\"7%\">泺研币</th> \
                                                        <th width=\"7%\">泺学分</th> \
                                                        <th width=\"20%\">任务完成时间</th> \
                                                    </tr> \
                                                </thead> \
                                                <tbody> \
                                                </tbody>"
                            getFinishedPublicTasks()
                        }

                        // 已完成任务点击事件
                        function finishedAllTasksClick()
                        {
                            // 获取点击任务的id号
                            var td = event.srcElement; // 通过event.srcElement 获取激活事件的对象 td
                            if (isNaN(td.parentElement.rowIndex))
                            {
                                var tdd = td.parentElement.parentElement.rowIndex
                            }
                            else
                            {
                                var tdd = td.parentElement.rowIndex
                            }
                            // console.log(td.parentElement.rowIndex + 1)
                            // console.log(td.parentElement.children[1].innerHTML)
                            // console.log(tdd)
                            if ((tdd > 0) && (document.getElementById('maxFinishedPage').innerHTML > 0))
                            {
                                clickId = finishedAllTasksList[tdd - 1].id
                                // console.log(clickId)
                                localStorage.setItem("fromPage", "index")
                                localStorage.setItem("finishedPage", finishedPage)
                                toTaskInfo(clickId)
                            }
                        }

                        // 已完成筛选条件改变
                        function finishedConditionChange()
                        {
                            var nowFinishedCondition = document.getElementById("finishedCondition").value

                            if (oldFinishedCondition != nowFinishedCondition)
                            {
                                finishedAllTasksReload()

                                oldFinishedCondition = nowFinishedCondition
                            }
                        }

                        // 页码加减
                        function finishedPageReduct()
                        {
                            finishedPage = finishedPage - 1
                            finishedAllTasksReload()
                        }

                        function finishedPagePlus()
                        {
                            finishedPage = finishedPage + 1
                            finishedAllTasksReload()
                        }

                        // 已完成任务页码突变
                        function finishedPageInputChange()
                        {
                            if (!(/(^[0-9]*[1-9][0-9]*$)/.test(document.getElementById('finishedPageInput').value)))
                            {
                                // 非正整数
                                if (document.getElementById('maxFinishedPage').innerHTML == 0)
                                {
                                    document.getElementById('finishedPageInput').value = ""
                                }
                                else
                                {
                                    document.getElementById('finishedPageInput').value = finishedPage
                                }

                                toastr.error("页码格式错误")
                            }
                            else if (document.getElementById('finishedPageInput').value > document.getElementById('maxFinishedPage').innerHTML)
                            {
                                // 页码超出了最大页
                                if (document.getElementById('maxFinishedPage').innerHTML == 0)
                                {
                                    document.getElementById('finishedPageInput').value = ""
                                }
                                else
                                {
                                    document.getElementById('finishedPageInput').value = finishedPage
                                }

                                toastr.error("页码已超出总数")
                            }
                            else
                            {
                                finishedPage = Number(document.getElementById('finishedPageInput').value)
                                finishedAllTasksReload()
                            }
                        }

                        /* ------------- 已完成 -------------*/

                        // 获取客户端系统时间
                        function getCurrentTime(i)
                        {
                            if (i == 2)
                            {
                                var dateStamp = new Date().setDate(new Date().getDate() + 7);
                                var date = new Date(dateStamp)
                            }
                            else if (i == 3)
                            {
                                var dateStamp = new Date().setDate(new Date().getDate() - 3);
                                var date = new Date(dateStamp)
                            }
                            else
                            {
                                var date = new Date();
                            }
                            // onsole.log(date)
			
                            var year = date.getFullYear();        //年 ,从 Date 对象以四位数字返回年份
                            var month = date.getMonth() + 1;      //月 ,从 Date 对象返回月份 (0 ~ 11) ,date.getMonth()比实际月份少 1 个月
                            var day = date.getDate();             //日 ,从 Date 对象返回一个月中的某一天 (1 ~ 31)
                            
                            var hours = date.getHours();          //小时 ,返回 Date 对象的小时 (0 ~ 23)
                            var minutes = date.getMinutes();      //分钟 ,返回 Date 对象的分钟 (0 ~ 59)
                            var seconds = date.getSeconds();      //秒 ,返回 Date 对象的秒数 (0 ~ 59)   
                            
                            //修改月份格式
                            if (month >= 1 && month <= 9) {
                                month = "0" + month;
                                }
                            
                            //修改日期格式
                            if (day >= 0 && day <= 9) {
                                day = "0" + day;
                                }
                            
                            //修改小时格式
                            if (hours >= 0 && hours <= 9) {
                                hours = "0" + hours;
                                }
                            
                            //修改分钟格式
                            if (minutes >= 0 && minutes <= 9) {
                                minutes = "0" + minutes;
                                }
                            
                            //修改秒格式
                            if (seconds >= 0 && seconds <= 9) {
                                seconds = "0" + seconds;
                                }
                            
                            //获取当前系统时间  格式(yyyy-mm-dd hh:mm:ss)
                            var currentFormatDate = year + "-" + month + "-" + day + " " + hours + ":" + minutes + ":" + seconds;
                            return currentFormatDate
                        }

                        function toTaskInfo(taskId)
                        {
                            // localStorage.setItem("nowPage", "taskInfo");
                            localStorage.setItem("taskId", taskId);
                            // console.log(localStorage.getItem("taskId"))
                            window.location.href = "index.php?nowPage=taskInfo";
                            // location.reload();
                        }
                    </script>